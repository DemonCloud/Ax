<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
</head>
<body>
<style>
	.router{
		color: #3f67a9;
		cursor: pointer;
		text-decoration: underline;
	}
</style>
<div id="tree"></div>
<div id="app"></div>
<div id="mount"></div>

<script src="./src/struct.js"></script>
<script src="./src/ax.js"></script>
<script src="./modules/Ax-Router.js"></script>
<script src="./modules/Ax-Loader.js"></script>

<script id="tpl" type='ax/tpl'>
	{{ var r=struct.random("string") }}
	{{ var ri=struct.random("int") }}
	<div>
		{{* each [route] in routes }}
	<router 
		class="router" 
		href="javascript:;"
		to="{{#route.path}}"
		query="id={{#r(6)}}&cd={{#ri(1,10000)}}">{{#route.name}}</router><br>
		{{* end}}
	</div>
</script>

<script id="state" type="ax/tpl">
	<div>
		<span>id =&gt; {{#query.id}}</span><br>
		<span>cd =&gt; {{#query.cd}}</span>
	</div>
</script>

<script>
var slice = struct.slice();
var merge = struct.merge();

var view = ax.view({
	template:document.getElementById("tpl").innerHTML,
});

var app = ax.view({
	root: document.getElementById("app"),
	template:document.getElementById("state").innerHTML,
})

view.mount(
	document.getElementById("tree"),
	{ 
		routes : [
			{ path: "/route", name:"Link1" },
			{ path: "/route/213", name:"Link2" },
			{ path: "/route/321/edit/2", name:"Link3"}
		]
	}
);

var size = struct.size();
var Router = ax.use("Router");

var route = new Router({
	elements: [".router"],

	routes:{
		"/": ["default"],
		"/route" : ["bone"],
		"/route/:id": ["bone"] ,
		"/route/:id/edit/:store" : ["bone"]
	},

	actions:{
		default: function(param,query,state){
			console.log(0,"default",state);

			app.render({ query: { 
				id: "default", 
				cd: "default" 
			} });

			if(!state.default) state.default = true;
		},

		bone: function(param,query,state){
			console.log(size(param)+1,"bone",state);

			app.render({ query: query });

			if(!state.bone) state.bone = true;
		}
	}
});

//#example2
var model2 = ax.model({ name:"111" });

var view2 = ax.view({
	template:"<div><input style='margin-bottom:5px' defaultValue='{{-text}}'>"+
	"<h2>{{-text}}</h2></div>",

	model : model2,

	events:{
		"change:input":function(event){
			this.model.set("text",event.target.value);
		}
	}
});

view2.mount(
	document.getElementById("mount"),
	{ text: "Hello World" }
);

route.start("/");
</script>
</body>
</html>
