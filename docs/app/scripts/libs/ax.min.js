!(function(t,e,n){if("function"==typeof define&&define.amd)define("ax",["struct"],(function(t){return n(e,t)}));else if("undefined"!=typeof exports){var i=require("struct");n(exports,i)}else t.ax=n(e,t._)})(this,{},(function(t,e){"use strict";function n(t){return function(e){return new t(vt(e)?e:{})}}function i(e){return function(n){var i=n;return function(n){return t[e](Kt(i,vt(n)?n:{}))}}}function o(t){return t._zid||(t._zid=Wt++)}function s(t,e,n,i){if((e=r(e)).ns)var s=a(e.ns);return(te[o(t)]||[]).filter((function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||s.test(t.ns))&&(!n||o(t.fn)===o(n))&&(!i||t.sel==i)}))}function r(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function a(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function u(t,e){return t.del&&!ee&&t.e in ne||!!e}function c(t){var e=0;if(null!=t.selectionStart)e=t.selectionStart;else if(document.selection){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),e=n.text.length}return e}function l(t,e){if(t.createTextRange){var n=t.createTextRange();n.move("character",e),n.select()}else t.selectionStart?t.setSelectionRange(e,e,t.focus()):t.focus()}function d(t){return ie[t]||se[t]||oe[t]||ee&&ne[t]||t}function h(t,e,n,i,s,a,h){var f=o(t),p=te[f]||(te[f]=[]);Tt(e.split(/\s/),(function(e){var o=r(e);o.fn=n,o.sel=s,o.e in ie&&(n=function(t){var e=t.relatedTarget;if(!e||e!==this&&!this.contains(e))return o.fn.apply(this,arguments)}),o.del=a;var f=a||n;o.proxy=function(e){var n,o=e.type,s=e.target.nodeName,r="true"===e.target.contentEditable,a=Gt(re,o)&&("INPUT"===s||"TEXTAREA"===s||r);if((e=v(e)).isImmediatePropagationStopped()||a&&e.target._compositionIn)return!1;Gt(ae,o)||(e.data=i),a&&(n=c(e.target));var u=f.apply(t,void 0===e._args?[e]:[e].concat(e._args));return!1===u&&(e.preventDefault(),e.stopPropagation()),n&&l(e.target,n),u},o.i=p.length,p.push(o);var m=d(o.e);m in se&&(t.addEventListener("compositionstart",(function(t){t.target._compositionIn=!0})),t.addEventListener("compositionend",(function(t){t.target._compositionIn=!1,U(t.target).trigger("input")}))),t.addEventListener(m,o.proxy,u(o,h))}))}function f(t,e,n,i,r){var a=o(t);Tt((e||"").split(/\s/),(function(e){Tt(s(t,e,n,i),(function(e){delete te[a][e.i],t.removeEventListener(d(e.e),e.proxy,u(e,r))}))}))}function p(){return!0}function m(){return!1}function v(t,e){if(e||!t.isDefaultPrevented){e||(e=t),Tt(ce,(function(n,i){var o=e[i];t[i]=function(){return this[n]=p,o&&o.apply(e,arguments)},t[n]=m}));try{t.timeStamp||(t.timeStamp=Date.now())}catch(t){}(void 0!==e.defaultPrevented?e.defaultPrevented:"returnValue"in e?!1===e.returnValue:e.getPreventDefault&&e.getPreventDefault())&&(t.isDefaultPrevented=p)}return t}function g(t){var e,n={originalEvent:t};for(e in t)ue.test(e)||void 0===t[e]||(n[e]=t[e]);return v(n,t)}function _(t,e){this.oldValue=t,this.newValue=e}function y(t,e){for(var n=[],i=0;i<t;i++)n[i]=e;return n}function b(t,e){var n,i=t.cloneNode();return Ee?i.appendChild((n=document.createElement("template"),n.innerHTML=e,n.content)):i.innerHTML=e,i}function N(t,e,n){var i=[],o=Ut(n);if(!o)return i;if(!ft(t,e))for(var s,r,a=at(n),u=0;u<o;u++)if(s=n[a[u]],r=Mt(e,a[u]),!s(r)){i.push(a[u],r);break}return i}function V(t,e){return gt(e)&&It(this,t,e),this}function w(t,e){return this.on(e,t)}function k(t,e){return Pt(this,t,e)}function x(t,e){return jt(this,t,e||[])}function E(t,e){return Vt(t)?t=t.concat(e):vt(t)?t=Kt(t,e):bt(t)?t+=e:t=e,t}function D(t,e){return console.warn(Ae({value:t,type:mt(t),msg:e||""})),!1}function A(t,e){return function(n){return t(n)||D(n,t({type:e}))}}function T(t){return function(e){return e instanceof t}}function S(t,e,n,i,o,s){var r={url:e,type:it[t],aysnc:!0,param:n,header:s};return r.success=function(){(i||ut).apply(this,arguments),this.emit(t+":success",arguments)}.bind(this),r.fail=function(){(o||ut).apply(this,arguments),this.emit(t+":fail",arguments)}.bind(this),this.emit(t,[Jt(r),r])}function O(t){return t.split("").reverse().join("")}function R(t,e){var n=$t(I(t),P(t,e),j(t));return function(){return n(arguments)}}function I(t){return function(e){return t.emit("beforeRender",e),e}}function P(t,e){return function(n){return e.apply(t,n),n}}function j(t){return function(e){return t.emit("completed",e),t}}function M(t,e){var n=R(t,e);return ct(t,"render",{get:function(){return n},set:function(e){return gt(e)&&(n=R(t,e)),n},enumerable:!0,configurable:!1}),t}function C(t){if(!Dt(t)&&!wt(t))throw new TypeError("el must be typeof DOMElement or NodeList collections -> not "+t);return!0}function L(t,e){var n=t.search("#"),i=t.search(e);return n>0?t.slice(n+1,~i?i:void 0):""}function z(t,e){var n=t.search(e);return zt(~n?t.slice(n+1):void 0)}function B(t,e,n){var i=L(t,e),o=z(t,e);St(this.routes,(function(t,e){new RegExp(e,"i").test(i)&&F.call(this,t,[o,i,n])}),this)}function F(t,e){gt(t)?t.apply(this,e):Ot(bt(t)?t.split(","):t,(function(t){this.actions[t].apply(this,e)}),this)}function G(t){return function(e,n){return gt(e)&&n===Re?e(t):[]}}function H(t){return t.name===this}function J(t,e){return function(n){n[t].apply(n,e||[])}}t.VERSION=e.VERSION;var U,q,X,$,Y,K,Z,Q,W={},tt={use:[]},et={data:{},validate:{}},nt={char:"@",routes:{},actions:{}},it={get:"GET",put:"POST",send:"GET",sync:"POST",post:"POST",fetch:"GET",update:"POST"},ot=e.root,st=e.v8(),rt=e.lock(),at=e.keys(),ut=e.noop(),ct=e.define(),lt=e.slice(),dt=e.clone(),ht=(e.depclone(),e.extend()),ft=(e.depextend(),e.eq()),pt=e.convert("string"),mt=e.type(),vt=e.type("object"),gt=e.type("function"),_t=e.type("num"),yt=e.type("bool"),bt=e.type("str"),Nt=e.type("int"),Vt=e.type("array"),wt=e.type("arraylike"),kt=e.type("primitive"),xt=e.type("float"),Et=e.type("dom"),Dt=e.type("elm"),At=e.type("node"),Tt=e.op(),St=e.op("object"),Ot=e.op("array"),Rt=(e.cat(),e.every()),It=e.event("on"),Pt=e.event("unbind"),jt=e.event("emit"),Mt=e.prop("get"),Ct=e.prop("set"),Lt=e.prop("not"),zt=e.param(),Bt=e.param("string"),Ft=e.string("trim"),Gt=e.has(),Ht=e.find(),Jt=e.ajax(),Ut=e.size(),qt=e.first(),Xt=e.last(),$t=e.link(),Yt=(e.assembly("u2b"),e.assembly("b2u"),e.doom()),Kt=e.merge(),Zt=e.index(),Qt=e.cool();q=function(t){this.el=wt(t)?lt(t):t instanceof Element?[t]:[]},U=function(t){return U.init.call(ot,t)};var Wt=1,te={},ee="onfocusin"in e.root,ne={focus:"focusin",blur:"focusout"},ie={mouseenter:"mouseover",mouseleave:"mouseout"},oe={check:"change"},se={change:"input",input:"input"},re=["input","keypress","keydown","keyup"],ae=["compositionstart","compositionupdate"].concat(["compositionend"]),ue=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,ce={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"},le=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||function(t){return null!=this.parentNode&&this!==document&&Gt(this.parentNode.querySelectorAll(t),this)};U.init=function(t){return new q(t)},U.matchz=function(t,e){return!(null===t||t===document||"string"!=typeof e)&&le.call(t,e)},U.event={add:h,remove:f},U.proxy=function(t,e){var n=2 in arguments&&lt(arguments,2);if(gt(t)){var i=function(){return t.apply(e,n?n.concat(lt(arguments)):arguments)};return i._zid=o(t),i}if("string"==typeof e)return n?U.proxy.apply(null,(n.unshift(t[e],t),n)):U.proxy(t[e],t);throw new TypeError("expected function")},U.Event=function(t,e){"string"!=typeof t&&(e=t,t=e.type);var n=document.createEvent(Gt(De.MouseEvent,t)?"MouseEvent":"Events"),i=!0;if(e)for(var o in e)"bubbles"===o?i=!!e[o]:n[o]=e[o];return n.initEvent(t,i,!0),v(n)};var de,he={addAttribute:0,modifyAttribute:1,removeAttribute:2,modifyTextElement:3,relocateGroup:4,removeElement:5,addElement:6,removeTextElement:7,addTextElement:8,replaceElement:9,modifyValue:10,modifyChecked:11,modifySelected:12,modifyComment:13,action:"a",route:"r",oldValue:"o",newValue:"n",element:"e",group:"g",from:"f",to:"t",name:"na",value:"v",data:"d",attributes:"at",nodeName:"nn",childNodes:"c",checked:"ch",selected:"s"},fe=function(t){ht(this,t||{})};fe.prototype={toString:function(){return JSON.stringify(this)},setValue:function(t,e){return this[t]=e,this}},_.prototype={contains:function(t){return t.length<this.length&&(t.newValue>=this.newValue&&t.newValue<this.newValue+this.length)},toString:function(){return this.length+" element subset, first mapping: old "+this.oldValue+" â†’ new "+this.newValue}};var pe=function(t){var e=[];return"#text"!==t.nodeName&&"#comment"!==t.nodeName&&(e.push(t.nodeName),t.attributes&&(t.attributes.class&&e.push(t.nodeName+"."+t.attributes.class.replace(/ /g,".")),t.attributes.id&&e.push(t.nodeName+"#"+t.attributes.id))),e},me=function(t){var e={},n={};return Ot(t,(function(t){Ot(pe(t),(function(t){var i=t in e,o=t in n;i||o?i&&(n[t]=delete e[t]):e[t]=!0}))})),e},ve=function(t,e){var n=me(t),i=me(e),o={};return Ot(at(n),(function(t){i[t]&&(o[t]=!0)})),o},ge=function(t){return delete t.outerDone,delete t.innerDone,delete t.valueDone,!t.childNodes||Rt(t.childNodes,ge)},_e=function(t,e){if(!Rt(["nodeName","value","checked","selected","data"],(function(n){return t[n]===e[n]})))return!1;if(Boolean(t.attributes)!==Boolean(e.attributes)||Boolean(t.childNodes)!==Boolean(e.childNodes))return!1;if(t.attributes){var n,i;if(n=at(t.attributes),i=at(e.attributes),n.length!==i.length)return!1;if(!Rt(n,(function(n){return t.attributes[n]===e.attributes[n]})))return!1}if(t.childNodes){if(t.childNodes.length!==e.childNodes.length)return!1;if(!Rt(t.childNodes,(function(t,n){return _e(t,e.childNodes[n])})))return!1}return!0},ye=function(t,e,n,i,o){var s,r,a;if(!t||!e||t.nodeName!==e.nodeName)return!1;if("#text"===t.nodeName)return!!o||t.data===e.data;if(t.nodeName in n)return!0;if(t.attributes&&e.attributes){if(t.attributes.id&&t.attributes.id===e.attributes.id&&t.nodeName+"#"+t.attributes.id in n)return!0;if(t.attributes.class&&t.attributes.class===e.attributes.class&&t.nodeName+"."+t.attributes.class.replace(/ /g,".")in n)return!0}return!!i||(r=t.childNodes?t.childNodes.slice().reverse():[],a=e.childNodes?e.childNodes.slice().reverse():[],r.length===a.length&&(o?Rt(r,(function(t,e){return t.nodeName===a[e].nodeName})):(s=ve(r,a),Rt(r,(function(t,e){return ye(t,a[e],s,!0,!0)})))))},be=function(t,e,n,i){var o,s,r=0,a=[],u=Array.apply(null,new Array(t.length+1)).map((function(){return[]})),c=ve(t,e),l=t.length===e.length;return l&&t.some((function(t,n){var i=pe(t),o=pe(e[n]);return i.length!==o.length?!(l=!1):(i.some((function(t,e){if(t!==o[e])return!(l=!1)})),!l)})),Ot(t,(function(t,o){Ot(e,(function(e,s){n[o]||i[s]||!ye(t,e,c,l)?u[o+1][s+1]=0:(u[o+1][s+1]=u[o][s]?u[o][s]+1:1,u[o+1][s+1]>=r&&(r=u[o+1][s+1],a=[o+1,s+1]))}))})),0!==r&&(o=[a[0]-r,a[1]-r],s=new _(o[0],o[1]),s.length=r,s)},Ne=function(t,e,n){var i=t.childNodes?y(t.childNodes.length,!0):[],o=e.childNodes?y(e.childNodes.length,!0):[],s=0;return Ot(n,(function(t){var e,n=t.oldValue+t.length,r=t.newValue+t.length;for(e=t.oldValue;e<n;e++)i[e]=s;for(e=t.newValue;e<r;e++)o[e]=s;s++})),{gaps1:i,gaps2:o}},Ve=function(t,e){for(var n=t.childNodes?t.childNodes:[],i=e.childNodes?e.childNodes:[],o=y(n.length,!1),s=y(i.length,!1),r=[],a=!0;a;)(a=be(n,i,o,s))&&Ot((r.push(a),Array.apply(null,new Array(a.length)).map((function(t,e){return e}))),(function(t){o[a.oldValue+t]=!0,s[a.newValue+t]=!0}));return r},we=function(){this.list=[]};we.prototype={list:!1,add:function(t){return Ot(t,(function(t){this.push(t)}),this.list)},forEach:function(t){Ot(this.list,t)}};var ke=function(t){ht(this,ht({debug:!1,diffcap:10,maxDepth:!1,valueDiffing:!0,textDiff:function(){arguments[0].data=arguments[3]},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null},t||{})),this._const=Object.freeze(dt(he))};ke.Diff=fe,ke.prototype={diff:function(t,e){var n=this.nodeToObj(t),i=this.nodeToObj(e);return de=0,this.debug&&(this.t1Orig=this.nodeToObj(t),this.t2Orig=this.nodeToObj(e)),this.tracker=new we,this.findDiffs(n,i)},findDiffs:function(t,e){var n;do{0===(n=this.findNextDiff(t,e,[])).length&&(_e(t,e)||(ge(t),n=this.findNextDiff(t,e,[]))),n.length>0&&this.applyVirtual(t,this.tracker.add(n))}while(n.length>0);return this.tracker.list},findNextDiff:function(t,e,n){var i,o;if(this.maxDepth&&n.length>this.maxDepth)return[];if(!t.outerDone){if(i=this.findOuterDiff(t,e,n),this.filterOuterDiff&&(o=this.filterOuterDiff(t,e,i))&&(i=o),i.length>0)return t.outerDone=!0,i;t.outerDone=!0}if(!t.innerDone){if((i=this.findInnerDiff(t,e,n)).length>0)return i;t.innerDone=!0}if(this.valueDiffing&&!t.valueDone){if((i=this.findValueDiff(t,e,n)).length>0)return t.valueDone=!0,i;t.valueDone=!0}return[]},findOuterDiff:function(t,e,n){var i,o,s=this,r=[];return t.nodeName!==e.nodeName?[(new fe).setValue(s._const.action,s._const.replaceElement).setValue(s._const.oldValue,t).setValue(s._const.newValue,e).setValue(s._const.route,n)]:t.data!==e.data?"#text"===t.nodeName?[(new fe).setValue(s._const.action,s._const.modifyTextElement).setValue(s._const.route,n).setValue(s._const.oldValue,t.data).setValue(s._const.newValue,e.data)]:[(new fe).setValue(s._const.action,s._const.modifyComment).setValue(s._const.route,n).setValue(s._const.oldValue,t.data).setValue(s._const.newValue,e.data)]:(i=t.attributes?at(t.attributes).sort():[],o=e.attributes?at(e.attributes).sort():[],Ot(i,(function(i){var a=o.indexOf(i);-1===a?r.push((new fe).setValue(s._const.action,s._const.removeAttribute).setValue(s._const.route,n).setValue(s._const.name,i).setValue(s._const.value,t.attributes[i])):(o.splice(a,1),t.attributes[i]!==e.attributes[i]&&r.push((new fe).setValue(s._const.action,s._const.modifyAttribute).setValue(s._const.route,n).setValue(s._const.name,i).setValue(s._const.oldValue,t.attributes[i]).setValue(s._const.newValue,e.attributes[i])))})),Ot(o,(function(t){r.push((new fe).setValue(s._const.action,s._const.addAttribute).setValue(s._const.route,n).setValue(s._const.name,t).setValue(s._const.value,e.attributes[t]))})),r)},nodeToObj:function(t){var e={};return e.nodeName=t.nodeName,"#text"===e.nodeName||"#comment"===e.nodeName?e.data=t.data:(t.attributes&&t.attributes.length>0&&(e.attributes={},Ot(Array.prototype.slice.call(t.attributes),(function(t){e.attributes[t.name]=t.value}))),t.childNodes&&t.childNodes.length>0&&(e.childNodes=[],Ot(Array.prototype.slice.call(t.childNodes),(function(t){e.childNodes.push(this.nodeToObj(t))}),this)),this.valueDiffing&&(void 0!==t.value&&(e.value=t.value),void 0!==t.checked&&(e.checked=t.checked),void 0!==t.selected&&(e.selected=t.selected))),e},objToNode:function(t,e){var n;return"#text"===t.nodeName?n=document.createTextNode(t.data):"#comment"===t.nodeName?n=document.createComment(t.data):("svg"===t.nodeName||e?(n=document.createElementNS("http://www.w3.org/2000/svg",t.nodeName),e=!0):n=document.createElement(t.nodeName),t.attributes&&Ot(at(t.attributes),(function(e){n.setAttribute(e,t.attributes[e])})),t.childNodes&&Ot(t.childNodes,(function(t){n.appendChild(this.objToNode(t,e))}),this),this.valueDiffing&&(t.value&&(n.value=t.value),t.checked&&(n.checked=t.checked),t.selected&&(n.selected=t.selected))),n},findInnerDiff:function(t,e,n){var i,o,s,r,a,u=this,c=t.childNodes&&e.childNodes?Ve(t,e):[],l=t.childNodes?t.childNodes:[],d=e.childNodes?e.childNodes:[],h=[],f=0;if(c.length>0&&(h=this.attemptGroupRelocation(t,e,c,n)).length>0)return h;for(o=Math.max(l.length,d.length),l.length!==d.length&&(i=!0),a=0;a<o;a+=1)s=l[a],r=d[a],i&&(s&&!r?"#text"===s.nodeName?(h.push((new fe).setValue(u._const.action,u._const.removeTextElement).setValue(u._const.route,n.concat(f)).setValue(u._const.value,s.data)),f-=1):(h.push((new fe).setValue(u._const.action,u._const.removeElement).setValue(u._const.route,n.concat(f)).setValue(u._const.element,s)),f-=1):r&&!s&&("#text"===r.nodeName?h.push((new fe).setValue(u._const.action,u._const.addTextElement).setValue(u._const.route,n.concat(f)).setValue(u._const.value,r.data)):h.push((new fe).setValue(u._const.action,u._const.addElement).setValue(u._const.route,n.concat(f)).setValue(u._const.element,r)))),s&&r&&(h=h.concat(this.findNextDiff(s,r,n.concat(f)))),f++;return t.innerDone=!0,h},attemptGroupRelocation:function(t,e,n,i){var o,s,r,a,u,c,l,d,h,f=this,p=Ne(t,e,n),m=p.gaps1,v=p.gaps2,g=Math.min(m.length,v.length),_=[];for(d=0,l=0;d<g;l+=1,d+=1)if(!0===m[d])if("#text"===(a=t.childNodes[l]).nodeName){if("#text"===e.childNodes[d].nodeName&&a.data!==e.childNodes[d].data){for(c=l;t.childNodes.length>c+1&&"#text"===t.childNodes[c+1].nodeName;)if(c+=1,e.childNodes[d].data===t.childNodes[c].data){u=!0;break}if(!u)return _.push((new fe).setValue(f._const.action,f._const.modifyTextElement).setValue(f._const.route,i.concat(d)).setValue(f._const.oldValue,a.data).setValue(f._const.newValue,e.childNodes[d].data)),_}_.push((new fe).setValue(f._const.action,f._const.removeTextElement).setValue(f._const.route,i.concat(d)).setValue(f._const.value,a.data)),m.splice(d,1),g=Math.min(m.length,v.length),d-=1}else _.push((new fe).setValue(f._const.action,f._const.removeElement).setValue(f._const.route,i.concat(d)).setValue(f._const.element,a)),m.splice(d,1),g=Math.min(m.length,v.length),d--;else if(!0===v[d])"#text"===(a=e.childNodes[d]).nodeName?(_.push((new fe).setValue(f._const.action,f._const.addTextElement).setValue(f._const.route,i.concat(d)).setValue(f._const.value,a.data)),m.splice(d,0,!0),g=Math.min(m.length,v.length),l--):(_.push((new fe).setValue(f._const.action,f._const.addElement).setValue(f._const.route,i.concat(d)).setValue(f._const.element,a)),m.splice(d,0,!0),g=Math.min(m.length,v.length),l--);else if(m[d]!==v[d]){if(_.length>0)return _;if(r=n[m[d]],(s=Math.min(r.newValue,t.childNodes.length-r.length))!==r.oldValue){for(o=!1,h=0;h<r.length;h+=1)ye(t.childNodes[s+h],t.childNodes[r.oldValue+h],[],!1,!0)||(o=!0);if(o)return[(new fe).setValue(f._const.action,f._const.relocateGroup).setValue("groupLength",r.length).setValue(f._const.from,r.oldValue).setValue(f._const.to,s).setValue(f._const.route,i)]}}return _},findValueDiff:function(t,e,n){var i=[],o=this;return t.selected!==e.selected&&i.push((new fe).setValue(o._const.action,o._const.modifySelected).setValue(o._const.oldValue,t.selected).setValue(o._const.newValue,e.selected).setValue(o._const.route,n)),(t.value||e.value)&&t.value!==e.value&&"OPTION"!==t.nodeName&&i.push((new fe).setValue(o._const.action,o._const.modifyValue).setValue(o._const.oldValue,t.value).setValue(o._const.newValue,e.value).setValue(o._const.route,n)),t.checked!==e.checked&&i.push((new fe).setValue(o._const.action,o._const.modifyChecked).setValue(o._const.oldValue,t.checked).setValue(o._const.newValue,e.checked).setValue(o._const.route,n)),i},applyVirtual:function(t,e){return Ot(e,(function(e){this.applyVirtualDiff(t,e)}),this),!0},getFromVirtualRoute:function(t,e){var n,i,o=t;for(e=e.slice();e.length>0;){if(!o.childNodes)return!1;i=e.splice(0,1)[0],n=o,o=o.childNodes[i]}return{node:o,parentNode:n,nodeIndex:i}},applyVirtualDiff:function(t,e){var n,i,o,s=this.getFromVirtualRoute(t,e[this._const.route]),r=s.node,a=s.parentNode,u=s.nodeIndex,c=this,l={diff:e,node:r};if(this.preVirtualDiffApply(l))return!0;switch(e[this._const.action]){case this._const.addAttribute:r.attributes||(r.attributes={}),r.attributes[e[this._const.name]]=e[this._const.value],"checked"===e[this._const.name]?r.checked=!0:"selected"===e[this._const.name]?r.selected=!0:"INPUT"===r.nodeName&&"value"===e[this._const.name]&&(r.value=e[this._const.value]);break;case this._const.modifyAttribute:r.attributes[e[this._const.name]]=e[this._const.newValue],"INPUT"===r.nodeName&&"value"===e[this._const.name]&&(r.value=e[this._const.value]);break;case this._const.removeAttribute:delete r.attributes[e[this._const.name]],0===at(r.attributes).length&&delete r.attributes,"checked"===e[this._const.name]?r.checked=!1:"selected"===e[this._const.name]?delete r.selected:"INPUT"===r.nodeName&&"value"===e[this._const.name]&&delete r.value;break;case this._const.modifyTextElement:r.data=e[this._const.newValue],"TEXTAREA"===a.nodeName&&(a.value=e[this._const.newValue]);break;case this._const.modifyValue:r.value=e[this._const.newValue];break;case this._const.modifyComment:r.data=e[this._const.newValue];break;case this._const.modifyChecked:r.checked=e[this._const.newValue];break;case this._const.modifySelected:r.selected=e[this._const.newValue];break;case this._const.replaceElement:(n=e[this._const.newValue]).outerDone=!0,n.innerDone=!0,n.valueDone=!0,a.childNodes[u]=n;break;case this._const.relocateGroup:Ot(r.childNodes.splice(e[this._const.from],e.groupLength).reverse(),(function(t){r.childNodes.splice(e[c._const.to],0,t)}));break;case this._const.removeElement:a.childNodes.splice(u,1);break;case this._const.addElement:o=(i=e[this._const.route].slice()).splice(i.length-1,1)[0],r=this.getFromVirtualRoute(t,i).node,(n=e[this._const.element]).outerDone=!0,n.innerDone=!0,n.valueDone=!0,r.childNodes||(r.childNodes=[]),o>=r.childNodes.length?r.childNodes.push(n):r.childNodes.splice(o,0,n);break;case this._const.removeTextElement:a.childNodes.splice(u,1),"TEXTAREA"===a.nodeName&&delete a.value;break;case this._const.addTextElement:o=(i=e[this._const.route].slice()).splice(i.length-1,1)[0],(n={}).nodeName="#text",n.data=e[this._const.value],(r=this.getFromVirtualRoute(t,i).node).childNodes||(r.childNodes=[]),o>=r.childNodes.length?r.childNodes.push(n):r.childNodes.splice(o,0,n),"TEXTAREA"===r.nodeName&&(r.value=e[this._const.newValue]);break;default:console.log("unknown action")}l.newNode=n,this.postVirtualDiffApply(l)},apply:function(t,e){return Ot(e,(function(e){this.applyDiff(t,e)}),this),!0},getFromRoute:function(t,e){e=e.slice();for(var n=t;e.length>0;){if(!n.childNodes)return!1;n=n.childNodes[e.splice(0,1)[0]]}return n},applyDiff:function(t,e){var n,i,o,s,r=this.getFromRoute(t,e[this._const.route]),a=this,u={diff:e,node:r};if(this.preDiffApply(u))return!0;switch(e[this._const.action]){case this._const.addAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(e[this._const.name],e[this._const.value]);break;case this._const.modifyAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(e[this._const.name],e[this._const.newValue]);break;case this._const.removeAttribute:if(!r||!r.removeAttribute)return!1;r.removeAttribute(e[this._const.name]);break;case this._const.modifyTextElement:if(!r||3!==r.nodeType)return!1;this.textDiff(r,r.data,e[this._const.oldValue],e[this._const.newValue]);break;case this._const.modifyValue:if(!r||void 0===r.value)return!1;r.value=e[this._const.newValue];break;case this._const.modifyComment:if(!r||void 0===r.data)return!1;this.textDiff(r,r.data,e[this._const.oldValue],e[this._const.newValue]);break;case this._const.modifyChecked:if(!r||void 0===r.checked)return!1;r.checked=e[this._const.newValue];break;case this._const.modifySelected:if(!r||void 0===r.selected)return!1;r.selected=e[this._const.newValue];break;case this._const.replaceElement:r.parentNode.replaceChild(this.objToNode(e[this._const.newValue],"http://www.w3.org/2000/svg"===r.namespaceURI),r);break;case this._const.relocateGroup:Ot(Array.apply(null,new Array(e.groupLength)).map((function(){return r.removeChild(r.childNodes[e[a._const.from]])})),(function(t,n){0===n&&(i=r.childNodes[e[a._const.to]]),r.insertBefore(t,i)}));break;case this._const.removeElement:r.parentNode.removeChild(r);break;case this._const.addElement:s=(o=e[this._const.route].slice()).splice(o.length-1,1)[0],(r=this.getFromRoute(t,o)).insertBefore(this.objToNode(e[this._const.element],"http://www.w3.org/2000/svg"===r.namespaceURI),r.childNodes[s]);break;case this._const.removeTextElement:if(!r||3!==r.nodeType)return!1;r.parentNode.removeChild(r);break;case this._const.addTextElement:if(o=e[this._const.route].slice(),s=o.splice(o.length-1,1)[0],n=document.createTextNode(e[this._const.value]),!(r=this.getFromRoute(t,o))||!r.childNodes)return!1;r.insertBefore(n,r.childNodes[s]);break;default:console.log("unknown action")}return u.newNode=n,this.postDiffApply(u),!0}};var xe=new ke({diffcap:998}),Ee="content"in document.createElement("template"),De={UIEvent:["focus","blur","focusin","focusout"],MouseEvent:["click","dbclick","mouseup","mousedown","mouseout","mouseover","mouseenter","mouseleave"],KeyboardEvent:["keydown","keypress","keyup"]};q.prototype={get:function(t){return 0 in arguments?this.el[+t+(t<0?this.length:0)]:this.el},each:function(t,e){return Ot(this.el,t,e||this),this},find:function(t){var e=[];return Ot(this.el,(function(n){e=lt(n.querySelectorAll(t)).concat(e)})),U(e)},closest:function(t,e){for(var n,i=this.el,o=this.get(0),s=0,r=i.length;s<r;s++,o=i[s]){for(;o&&!n&&o!==e;)U.matchz(o=o.parentNode,t)&&(n=o);if(n)break}return U(n||[])},on:function(t,e,n,i,o){var s,r,a=this;return t&&"string"!=typeof t?(Tt(t,(function(t,i){a.on(i,e,n,t,o)})),a):("string"==typeof e||gt(i)||!1===i||(i=n,n=e,e=void 0),void 0!==i&&!1!==n||(i=n,n=void 0),!1===i&&(i=m),a.each((function(a){o&&(s=function(t){return f(a,t.type,i),i.apply(this,arguments)}),e&&(r=function(t){var n,o=U.matchz(t.target,e)?t.target:U(t.target).closest(e,a).get(0);if(o&&o!==a)return n=ht(g(t),{currentTarget:o,liveFired:a}),(s||i).apply(o,[n].concat(lt(arguments,1)))}),h(a,t,i,n,e,r||s)})))},off:function(t,e,n){return t&&"string"!=typeof t?(Tt(t,(function(t,n){this.off(n,e,t)}),this),this):("string"==typeof e||gt(n)||!1===n||(n=e,e=void 0),!1===n&&(n=m),this.each((function(i){f(i,t,n,e)})))},trigger:function(t,e){return t="string"==typeof t?U.Event(t):v(t),t._args=e,this.each((function(n){t.type in ne&&gt(n[t.type])?n[t.type]():"dispatchEvent"in n?n.dispatchEvent(t):U(n).triggerHandler(t,e)}))},triggerHandler:function(t,e){var n,i;return this.each((function(o){(n=g("string"==typeof t?U.Event(t):t))._args=e,n.target=o,Tt(s(o,t.type||t),(function(t){if(i=t.proxy(n),n.isImmediatePropagationStopped())return!1}))})),i},html:function(t){return this.each((function(e){e.innerHTML=t}))},render:function(t){return this.each((function(e){this.apply(e,this.diff(e,b(e,1===t.nodeType?t.outerHTML:pt(t))))}),xe)}};Yt("[ checker -> ax.va.{{#type}} ]");var Ae=Yt("The value Of *( {{#value}} ) with type [ {{#type}} ] not pass validate! {{#msg}}"),Te=[],Se=ot.localStorage,Oe=String.fromCharCode;Z={t:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",kAt:function(t,e){return t.charCodeAt(~~(e%t.length))},ecd:function(t){var e,n,i,o,s,r,a=0,u="";if(!t)return t;do{e=(s=t[a++]<<16|t[a++]<<8|t[a++])>>18&63,n=s>>12&63,i=s>>6&63,o=63&s,u+=this.t.charAt(e)+this.t.charAt(n)+this.t.charAt(i)+this.t.charAt(o)}while(a<t.length);return r=t.length%3,(r?u.slice(0,r-3):u)+"===".slice(r||3)},dcd:function(t){var e,n,i,o,s,r,a=0,u=[];if(!t)return t;t+="";do{e=(r=this.t.indexOf(t.charAt(a++))<<18|this.t.indexOf(t.charAt(a++))<<12|(o=this.t.indexOf(t.charAt(a++)))<<6|(s=this.t.indexOf(t.charAt(a++))))>>16&255,n=r>>8&255,i=255&r,u.push(e),64!==o&&(u.push(n),64!==s&&u.push(i))}while(a<t.length);return u},incry:function(t,e){for(var n=[],i=0,o=t.length;i<o;i++)n[i]=t[i].charCodeAt(0)^this.kAt(e,i);return this.ecd(n)},decyt:function(t,e){for(var n=0,i=(t=this.dcd(t)).length;n<i;n++)t[n]=Oe(t[n]^this.kAt(e,n));return t.join("")},set:function(t,e){Se.setItem("Ax@"+this.incry(t,O(t)),this.incry(JSON.stringify(e),t))},get:function(t){var e=Se.getItem("Ax@"+this.incry(t,O(t)));return e?JSON.parse(this.decyt(e,t)):0},rm:function(t){Se.removeItem("Ax@"+this.incry(t,O(t)))}},(X=function(t){var e=ht(dt(et),t||{}),n=e.events,i=e.validate,o=bt(e.name||0),s=e.store&&o,r=e.data||{},a=s?Z.get(e.name)||r:r;delete e.data,delete e.store,delete e.change,delete e.events,delete e.validate,ct(this,"data",{get:function(){return dt(a)},set:function(t){if(ft(a,t))return a;var e,n=[dt(t)];return this.emit("validate",n),(kt(t)?gt(i)&&!i(t):(e=N(a,t,i),Ut(e)))?(this.emit("validate:fail",n.concat(e)),Vt(e)&&2===Ut(e)&&this.emit("validate:fail:"+qt(e),[Xt(e)]),a):(a=t,this.change=!0,s&&Z.set(this.name,t),this.emit("validate:success,change",n),t)},enumerable:!0,configurable:!1}),St(n,w,this),ht(this,e).emit("init",[this.data]).unbind("init"),Te[o?this.name:"_"]=this}).prototype={get:function(t){return yt(t)||!t&&0!==t?this.data:Mt.apply(this,[this.data].concat(lt(arguments)))},set:function(t,e){return this.data=1 in arguments?Ct(this.data,t,e):void 0===t?this.data:t,bt(t)?this.emit("change:"+t,[e]):this},rm:function(t){var e=this.data;return null!==(this.data=t?Vt(e)?(e.splice(+t,1),e):Lt(e,t):null)&&this.emit("remove:"+t)},moc:function(t,e){return this.set(t,E(Mt(this.data,t),e))},on:V,emit:x,unbind:k,toJSON:function(){return kt(this.data)?this.data:JSON.stringify(this.data)},send:function(t,e){return vt(t)&&(e=t,t=null),S.apply(this,["send",t||this.url,this.data,ut,ut,e])},fetch:function(t,e,n){return gt(t)&&(n=e,e=t,t={}),S.apply(this,["fetch",this.url,t,$t(gt(e)?e:JSON.parse,this.set.bind(this)),ut,n])},sync:function(t,e){return vt(t)&&(e=t,t=null),S.apply(this,["sync",t||this.url,this.data,ut,ut,e])},toString:function(){return pt(this.toJSON())}},($=function(t){var e=ht(dt(W),t||{}),n=e.root,i=e.render,o=e.events,s=e.template,r=e.props;delete e.root,delete e.mount,delete e.props,delete e.events,delete e.render,delete e.template,gt(i)||(s=bt(s)?Yt(s,vt(r)?r:{}):gt(s)?s:ut,i=function(){var t=U(n),e=lt(arguments);return s!==ut&&(""===Ft(t.get(0).innerHTML)?t.html(s.apply(this,e)):t.render(s.apply(this,e)))}),n&&C(n)?(this.root=n,St(o,w,M(this,i)),e.model&&Q.model(e.model)&&e.model.on("change",this.render.bind(this))):this.mount=function(t){if(C(t))return this.root=n=t,St(o,w,M(this,i)),e.model&&Q.model(e.model)&&e.model.on("change",this.render.bind(this)),1 in arguments&&this.render.apply(this,lt(arguments,1)),delete this.mount,this},ht(this,e).emit("init").unbind("init")}).prototype={on:function(t,e){return Ot((t||"").split(","),(function(t){var n=t.split(":");n.length>1?U(this.root).on(n[0],n[1],{self:this},e):It(this,t,e)}),this),this},unbind:function(t,e){return Ot((t||"").split(","),(function(t){var n=t.split(":");n.length>1?U(this.root).off(n[0],n[1],e):Pt(this,t,e)}),this),this},emit:function(t,e){var n=(t||"").split(":");return n.length>2?(Ot((t||"").split(","),(function(t){var n=t.split(":");U(this.root).find(n[1]).trigger(n[0],e)}),this),this):n.length>1?(U(this.root).find(n[1]).trigger(n[0],e),this):jt(this,t,e)},toString:function(){return this.root}},(Y=function(t){var e=this,n={old:"",now:ot.location.href},i=ht(dt(nt),t||{}),o=i.events;delete i.history,delete i.events,ct(this,"event",{value:function(t){return ot.location.href===n.now?t.preventDefault():(n.old=n.now,e.emit("hashchange",[n.now=ot.location.href,i.char,t]))},writable:!1,enumerable:!1,configurable:!1}),St(o,w,this),ht(this,i).on("hashchange",B).emit("init").unbind("init")}).prototype={on:V,emit:x,unbind:k,listen:function(t,e){return this._listen?this:(ct(this,"_listen",{value:!ot.addEventListener("hashchange",this.event),writable:!1,enumerable:!1,configurable:!0}),t?this.assign(t,e):this.emit("hashchange",[ot.location.href,this.char]))},stop:function(){return delete this._listen&&ot.removeEventListener("hashchange",this.event),this},assign:function(t,e){if(this._listen){var n=ot.location.href,i=n.search("#");i>0&&(n=n.slice(0,i)),ot.location.href=n+("#"===t.toString().slice(0,1)?"":"#")+t+(vt(e)?(this.char||"@")+Bt(e):"")}return this},toString:function(){return this}};var Re=[];return K=function(t){var e=ht(dt(tt),t||{}),n=e.use,i=e.events,o=[];delete e.use,delete e.events,St(i,w,this),this._assert=G(o),ht(this.use(n),e).emit("init").unbind("init")},K.prototype={all:function(){return this._assert(lt,Re)},on:V,emit:x,unbind:k,use:function(t){var e=this._assert(Qt,Re),n=bt(t)?[t]:Vt(t)?t:[];return Ot(n,(function(t){var n=Te[t];t&&n&&Q.model(n)&&!Gt(e,n)&&e.push(n)})),this},out:function(t){var e=this._assert(Qt,Re),n=bt(t)?[t]:Vt(t)?t:[];return Ot(n,(function(t){e.splice(Zt(e,H.bind(t)),1)})),this},get:function(t){return Ht(this.all(),H.bind(t)).pop()},of:function(t,e){return Ot(this.all(),gt(t)?t:J(t,e))},noti:function(t,e){return this.of((function(n){return n.emit(t,e)}))}},Ot(["extend","not","cat","find","filter","reject","chunk","compact","pluck","groupBy","countBy","pairs","shuffle","flat","merge","map","sort","unique","concat"],(function(t){X.prototype[t]=function(){var n=this.data,i=[n].concat(lt(arguments));return ft(n=e[t]().apply(n,i),this.data)||this.emit((this.data=n,t),i),this}})),Ot(["keys","diff","intsec","first","last","auto","eq","values","size","each","has","type","index"],(function(t){X.prototype[t]=function(){var n=[this.data].concat(lt(arguments));return e[t]().apply(this,n)}})),t.route=n(Y),t.model=n(X),t.view=n($),t.atom=n(K),t.route.extend=i("route"),t.model.extend=i("model"),t.view.extend=i("view"),t.atom.extend=i("atom"),t.va=Q={fn:A(gt,"function"),int:A(Nt,"int"),array:A(Vt,"array"),float:A(xt,"float"),string:A(bt,"string"),object:A(vt,"object"),number:A(_t,"number"),arrayLike:A(wt,"arrayLike"),primitive:A(kt,"primitive"),bool:A(yt,"boolean"),dom:A(Et,"dom"),element:A(Dt,"element"),node:A(At,"node"),model:A(T(X),"model"),view:A(T($),"view"),atom:A(T(K),"atom"),route:A(T(Y),"route")},rt(X,$,Y,K,Z,Q,st(t))}));