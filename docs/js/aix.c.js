!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e._=t()}(this,function(){"use strict";function e(e,t,n){for(var i=0,r=e.length;i<r;i++)t.apply(n||e,[e[i],i,e]);return e}function t(t,n,i){var r=m.keys(t);return e(r,function(e,r){n.call(i||t,t[e],e,t)},i||t),t}function n(e){return decodeURIComponent(e.replace(/\+/g," "))}function i(e){return encodeURIComponent(e).replace(" ","%20")}function r(e){return _[e]||e}function o(e){return b[e]||e}function a(e){return"\\"+E[e]}function s(e){var t=document.createElement(e.tagname);return m.foreach(e.attributes,function(e,n){t.setAttribute(n,e)}),e.child?e.child.length||(t.innerHTML=e.content):t.innerHTML=e.content,t}function u(e,t){var n=(e||document.createElement("div")).cloneNode();if(n.setAttribute("x-root",""),t.length){for(var i=t[1],r=0,o=i.length;r<o;r++)n.appendChild(s(i[r]));for(var r=2,o=t.length;r<o;r++)for(var a=0,u=t[r].length;a<u;a++){var c=t[r][a],l=s(c);n.querySelector("[x-aim='"+c.parent["@"]+"']").appendChild(l)}}return n}var c="0.1",l=Object.prototype,f=[],h=f.slice,d=f.splice,p=function(){return this||(0,eval)("this")}(),m={};m.extend=function(e){var t=h.call(arguments);if(t.length>1)m.compose(e,t[1],t[2]);else for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);return e},m.define=function(e,t,n){return m.isObject(t)?Object.defineProperties(e,t):Object.defineProperty(e,t,n)},m.isObject=function(e){return"function"==typeof e||"object"==typeof e&&!!e};var v=["Array","Arguments","Boolean","Function","String","Number","Null","Date","RegExp","NodeList","Undefined","HTMLCollection"];v.forEach(function(e,t){m["is"+e]=function(t){return l.toString.call(t)==="[object "+e+"]"}}),m.extend({NULL:function(){},cool:function(e){return e},root:p,broken:{},version:c,foreach:function(n,i,r){if(null!=n){if(this.isArray(n))return e(n,i,r);if(m.isObject(n)&&!m.isFunction(n))return t(n,i,r)}return n},loop:function(){return this.foreach.apply(this,m.slice(arguments))},keys:function(e){if(null!==e)return m.isArray(e)?Object.keys(e).map(function(e){return+e}):Object.keys(e)},slice:function(e){return null!=e?h.call(e):[]},splice:function(e,t,n){return m.isArray(e)?d.call(e,t,n||1):delete e[t],e},pop:function(e){return m.isArray(e)?e.pop():e},shift:function(e){return m.isArray(e)?e.shift():e},push:function(e){return m.isArray(e)&&e.push.apply(e,h.call(arguments,1)),e},unshift:function(e){return m.isArray(e)&&e.unshift.apply(e,h.call(arguments,1)),e},clone:function(e){return m.isArray(e)?h.call(e):m.isObject(e)&&!m.isFunction(e)?JSON.parse(JSON.stringify(e)):e},clonedoom:function(e){if(m.isArray(e)||m.isArguments(e)||m.isNodeList(e)||m.isHTMLCollection(e))return h.call(e);if(m.isObject(e)&&!m.isFunction(e)){var t=function(){};t.prototype=e.constructor.prototype;var n=new t;return m.foreach(e,function(e,t){m.isString(e)||m.isNumber(e)||m.isFunction(e)?n[t]=e:n[t]=m.clonedoom(e)}),n}return e},sort:function(e,t){return m.isArray(e)?e.sort(t):e},unique:function(e){for(var t=0,n=e.length;t<n;t++)if(t!==e.length-1)for(var i=t+1;i<e.length;i++)e[t]===e[i]&&e.splice(i--,1);return e},find:function(){return this.filter.apply(this,m.slice(arguments))},filter:function(e,t,n){var i=[];return m.foreach(m.clonedoom(e),function(e,i){t.call(this,e,i,this)&&!n&&this.push(e)},i),i},reject:function(e,t){var n=[];return m.foreach(m.clonedoom(e),function(e,n){t.call(this,e,n,this)||this.push(e)},n),n},map:function(e,t){return m.foreach(e,function(e,n){this[n]=t.call(this,e,n,this)},e)},cat:function(e,t){var n=[];if(m.isArray(e))for(var i=0,r=e.length;i<r;i++)t.call(e,e[i],i,e)&&n.push(e.splice(i,1).pop())&&i--;else if(m.isObject(e))for(var i in e)if(e.hasOwnProperty(i)&&t.call(e,e[i],i,e)){var o={};o[i]=e[i],n.push(o),delete e[i]}return n},findindex:function(e,t){var n=[];return m.foreach(e,function(e,n){t.call(this,e,n,this)&&this.push(n)},n),n},hook:function(e,t){var n=h.call(arguments,2),i=m.isFunction(t);return this.map(e,function(e){return(i?t:e[t]).apply(e,n)})},bind:function(e){var t=h.call(arguments,1);return m.foreach(e,function(n,i){this.isFunction(n)&&(e[i]=Function.bind.apply(n,t))},this),e},reverse:function(e){return m.isArray(e)?this.slice(e).reverse():e},pluck:function(e,t){var n=[];return m.foreach(e,function(e){for(var n=m.keys(e),i=n.length;i--;)n[i]===t+""&&this.push(e[n[i]])},n),n},groupby:function(e,t){if(m.isArray(e)){var n={},i=m.isFunction(t);return m.foreach(e,function(e){var n=i?t(e):e[t];this[n]?this.hasOwnProperty(n)&&this[n].push(e):this[n]=[e]},n),n}return e},toarray:function(e){for(var t=m.keys(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=e[t[r]];return i},forarray:function(e){for(var t=m.keys(e),n=t.length,i=Array(n),r=0;r<n;r++){var o={};o[t[r]]=e[t[r]],i[r]=o}return i},pairs:function(e){for(var t=[],n=m.keys(e),i=0,r=n.length;i<r;i++)t.push([n[i],e[n[i]]]);return t},random:function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},compose:function(e,t,n){return n?m.foreach(t,function(t,i){var r=this.isArray(n)?!this.has(n,i):null==n||i!==n;r&&(e[i]=t)},this):m.foreach(t,function(t,n){e[n]=t}),e},has:function(e,t){var n=0;return m.foreach(e,function(e){e===t&&(n=1)}),!!n},not:function(e,t){for(var n=0,i=e.length;n<i;n++)m.isequal(e[n],t)&&m.splice(e,n--);return e},bale:function(e,t,n){return m.isArray(e)&&m.isArray(t)?[].concat(e).concat(t):m.compose(m.clonedoom(e),m.clonedoom(t),n)},shuffle:function(e){for(var t,n=m.isArray(e)?e:m.toarray(e),i=n.length,r=Array(i),o=0;o<i;o++)t=m.random(0,o),t!==o&&(r[o]=r[t]),r[t]=n[o];return r},trim:function(e){return e.replace(/^\s+|\s+$/gm,"")},merge:function(){var e=[],t=h.call(arguments);return t.forEach(function(t){e=e.concat(t)}),this.unique(e)},partial:function(e){var t=h.call(arguments,1);return function(){for(var n=0,i=t.slice(),r=0,o=i.length;r<o;r++)i[r]===m&&(i[r]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return e.apply(this,i)}},before:function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},part:function(e,t){var n=m.partial(m.before,(parseInt(t)||1)+1);return n(e)},once:function(e){return m.part(e,1)},isequal:function(e,t,n){if(n||null==e||null==t||m.isFunction(e)||m.isFunction(t)||e===t)return e===t;if(m.typeof(e)!==m.typeof(t))return!1;if(e.toString()===t.toString()){if(m.isArray(e)){if(e.length===t.length){for(var i=e.length;i--;)if(e[i]!==t[i])return!1;return!0}return!1}if(m.isObject(e)){var r=m.keys(e),o=m.keys(t);if(r.length===o.length){for(var i=r.length;i--;)if(e[r[i]]!==t[r[i]])return!1;return!0}return!1}}return!1},typeof:function(e){var t,n=[m.isArray(e),m.isArguments(e),m.isBoolean(e),m.isFunction(e),m.isString(e),m.isNumber(e),m.isNull(e),m.isDate(e),m.isRegExp(e),m.isNodeList(e),m.isUndefined(e),m.isHTMLCollection(e)];return t=m.findindex(n,function(e){return e===!0}).shift(),null==t?"object":v[t].toLowerCase()},requery:function(e){var t={};return m.foreach(e,function(e){t[e.name]=e.value}),t},async:function(e,t){return setTimeout(e,t||0)},combom:function(e,t){for(var n,i=0,r=e.length;i<r;i++)if(t.call(e,e[i],i,e)){n=e[i];break}return n}});var g=/[\t\r\n\f\x20]/g;m.extend({paramparse:function(e){var t,i,r=e.indexOf("?"),o=/([^&=]+)=?([^&]*)/g,a={};for(t=r===-1?e:e.substr(r+1);i=o.exec(t);)a[n(i[1])]=n(i[2]);return a},paramstringify:function(e){var t=m.clone(e);for(var n in t)t[n]=i(m.isObject(t[n])||m.isArray(t[n])?JSON.stringify(t[n]):t[n]);var r=JSON.stringify(t);return r.replace(/[\"\{\}]/g,"").replace(/:/g,"=").replace(/,/g,"&").replace(g,"")},stringparse:function(e){return m.isBoolean(e)?e:e+""}});var _={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"$quot;","'":"&#x27;","`":"&#x60"},b={"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#x27;":"'","&#x60;":"`"},y="(.)^",N=/\\|'|\r|\n|\u2028|\u2029/g,E={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};m.doomSetting={escape:"{{-([\\s\\S]+?)}}",interpolate:"{{#([\\s\\S]+?)}}",evaluate:"{{([\\s\\S]+?)}}"};if(m.extend({encodeHTML:function(e){return+e===e?e:e.replace(/[&<">'](?:(amp|lt|quot|gt|#39);)?/g,r)},decodeHTML:function(e){return+e===e?e:e.replace(/&((g|l|quo)t|amp|#39);/g,o)},doom:function(e,t){var n=0,i="_p+='",r=h.call(arguments,2),o=RegExp((this.doomSetting.escape||y)+"|"+(this.doomSetting.interpolate||y)+"|"+(this.doomSetting.evaluate||y)+"|$","g");e.replace(o,function(t,r,o,s,u){return i+=e.slice(n,u).replace(N,a),n=u+t.length,r?i+="'+\n((_t=("+r+"))==null?'':_.encodeHTML(_t))+\n'":o?i+="'+\n((_t=("+o+"))==null?'':_t)+\n'":s&&(i+="';\n"+s+"\n_p+='"),t}),i+="';\n",t||(i="with(_x||{}){\n"+i+"}\n"),i="var _t,_p='';\n"+i+"return _p;\n";try{var s=(0,eval)("(function("+(t||"_x")+",_"+(r.length?","+r.toString():"")+"){"+i+"})")}catch(e){throw e.res=i,console.log(i),e}return function(e){return s.apply(this,[e,m].concat(h.call(arguments,1)))}}}),m.extend({watch:function(e,t,n){function i(){return a}function r(i){return o=a,a=n.call(e,i,o,t)}var o=e[t],a=o;return delete e[t]&&(Object.defineProperty?Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0}):Object.prototype.__defineGetter__&&Object.prototype.__defineSetter__&&(Object.prototype.__defineGetter__.call(e,t,i),Object.prototype.__defineSetter__.call(e,t,r))),e},unwatch:function(e,t){var n=e[t];return delete e[t],e[t]=n,e}}),m.extend({addEvent:function(e,t,n){return e._events||m.define(e,"_events",{value:{},writable:!0,enumerable:!1,configurable:!0}),e._events[t]||(e._events[t]=[]),m.has(e._events[t],n)||e._events[t].push(n),e},removeEvent:function(e,t,n){if(e._events[t])m.not(e._events[t],n),e._events[t].length&&n||delete e._events[t];else if(!t&&!n)return m.release(e);return e},release:function(e){return delete e._events,e},dispatch:function(e,t,n,i){var r=m.isFunction(n);return e._events&&e._events[t]&&(r?m.foreach(e._events[t],function(t){t===n&&t.apply(e,i||[])}):m.foreach(e._events[t],function(t){t.apply(e,i||[])})),e},trigger:function(){return m.dispatch(m.slice(arguments))}}),m.root.self){var x=function(e){this.info=e.userAgent,this.language=e.language,this.platform=e.platform};m.extend(x.prototype,{defineBroswer:function(e,t){var n=this.info;this.browser={};for(var i=e.length;i--;)t[i].call(n,m.root)?this.browser[e[i]]=!0:this.browser[e[i]]=!1;return this},definePlatform:function(e,t){var n=this.info;this.version={};for(var i=e.length;i--;)this.version[e[i]]=t[i].call(n,m.root);return this}});var w=new x(m.root.navigator).defineBroswer(["IE","Edge","Opera","Chrome","Safari","FireFox","Mobile","Desktop"],[function(){return/(Trident|MSIE)/i.test(this)},function(){return/Edge/i.test(this)&&/Webkit/i.test(this)},function(){return/Opera/i.test(this)&&/Webkit/i.test(this)},function(e){return null!=e.chrome},function(){return/Safari/i.test(this)&&!/Chrome/i.test(this)},function(e){return/Firefox/i.test(this)&&e.netscape&&/Gecko/.test(this)},function(e){return e.devicePixelRatio>1},function(e){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(e.navigator.userAgent)||null==e.devicePixelRatio}]).definePlatform(["OS","RenderEnginner","Chrome","Firefox","IE"],[function(e){return/Windows/gi.test(this)?"Windows":/(Linux|Ubuntu|CentOS|Debian|Arach|RedHat|FreeBSD|Unix)/gi.test(this)?"Linux":/Macintosh/gi.test(this)?"Mac OS X":/iOS|iPad|iPhone/gi.test(this)?"iOS":/Android/gi.test(this)?"Android":"UnKown"},function(e){return/(Webkit|Gecko|Trident)/gi.exec(this)[0]},function(e){return!!/Chrome/gi.test(this)&&this.match(/(Chrome)\/([\d\.]+)/gi)[0].replace(/[^\d\.]/gi,"")},function(e){return!!/Firefox/gi.test(this)&&/Firefox\/([\d\.]+)/gi.exec(this)[1]},function(e){return!!/IE/gi.test(this)&&parseInt(/MSIE\ ([\d\.]+)/gi.exec(this)[1])}]),T=0,A=m.root.localStorage;A.getItem("aixcache")||A.setItem("aixcache","{}");var L=/<(\/)?(\w+)\s?([^>]+?)?\>{1}/gi,O=/([^<>\s]+)=[\'\"]?([^>\'\"]+)[\'\"]?\s/gi,k=function(e,t){var n={};return e=" "+(e||"")+" ",e.replace(O,function(e,t,i){return n[t]=i,e}),n["x-aim"]=t,n},S=["input","hr","br","img","area","base","!DOCTYPE","!--"];m.extend({datamime:function(e,t){if(m.isObject(e)&&e["Content-type"])switch(e["Content-type"]){case"application/json":return JSON.stringify(t||{});default:return m.paramstringify(t||{})}return m.paramstringify(t||{})},strip:function(e,t){var n=m.isString(e)?e.replace(/<script\b[^>]*>(.*?)<\/script>/gim,""):"";return t?n.replace(/[\t\r\n\f]/gm,""):n},domparse:function(e){var t=m.trim(m.strip(e)),n=1,i=1,r=[],o=[],a=1;t.replace(L,function(e,t,s,u,c){var l={};l["@"]=a++;var f;if("/"!==t){f=n++,null==r[f]&&(r[f]=[]);f-i++;m.compose(l,{tagname:s,attributes:k(m.trim(u||""),l["@"]),$ob:c+e.length}),r[f].push(l),m.has(S,s)?(--n,--i,l.$oe=0):o.push(l)}else{f=--n,--i,--a;var h=o.pop();h.$oe=c-h.$ob}return e});for(var s=1,u=r.length;s<u;s++)for(var c=r[s],l=r[s+1],f=r[s-1],h=0,d=c.length;h<d;h++){var p=c[h].$ob,v=c[h].$oe,g=null;c[h].content=m.trim(t.substr(p,v)),l&&(g=m.filter(l,function(e,t){return e.$ob>p&&e.$ob+e.$oe<p+v}),0===g.length&&(g=null)),c[h].child=g,c[h].parent=f?m.combom(f,function(e,t){return p>e.$ob&&p+v<e.$ob+e.$oe}):null}return r},virtualDOM:function(e,t){var n=m.domparse(t||"");return u(e,n)},cookieparse:function(e){var t,n={},i=e?e.split(";"):[];return i.forEach(function(e){t=(e||"").split("="),t.length&&(n[m.trim(t[0])]=m.trim(t[1]))}),n},cookie:function(e){var t=m.slice(arguments),n=t.length,i=m.cookieparse(m.root.document.cookie);if(n){if(1===n)return i[e];var r=new Date;return r.setDate(r.getDate()+365),m.root.document.cookie=m.trim(t[0]+"="+(t[1]||"")+";expires="+(t[2]||r.toGMTString())+";path="+(t[3]||"/")+";domain="+(t[4]||"")+";"+(t[5]?"secure":""))}return i},aix:function(e){var t=m.compose({url:"",type:"GET",param:m.broken,charset:"utf-8",aysnc:!0,vaild:!0,cache:!1,success:m.NULL,fail:m.NULL,loading:null,loaded:null,header:m.broken,username:null,password:null,timeout:0},e||{});if(t.cache){var n=JSON.parse(A.getItem("aixcache")),i=t.url||m.root.location.href.split("#")[0];if(n[i])return t.success.call(m.root,n[i])}var r=new XMLHttpRequest;if("GET"===t.type.toUpperCase()&&t.param&&(t.url+=(t.url.search(/\?/g)===-1?m.keys(t.param).length?"?":"":"&")+m.paramstringify(t.param),t.param=null),m.isFunction(t.loading)){var o=function(e){t.loading.call(m.root,e)};r.addEventListener("loadstart",function(e){o(e),r.removeEventListener("loadstart",o),o=null})}if(m.isFunction(t.loaded)){var a=function(e){t.loaded.call(m.root,e)};r.addEventListener("loadend",function(e){a(e),r.removeEventListener("loadend",a),a=null})}if(null!=t.username?r.open(t.type,t.url,t.aysnc,t.username,t.password||""):r.open(t.type,t.url,t.aysnc),"POST"===t.type&&t.param&&!t.header["Content-type"]&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset="+t.charset),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Aix-Requested","AixHttpRequest"),m.isObject(t.header)&&t.header!==m.broken){var s=t.header["Content-type"];null!=s&&(s.search("charset")>-1||s.search("json")>-1||(t.header["Content-type"]+=";charset="+t.charset)),m.foreach(t.header,function(e,t){r.setRequestHeader(t,e)})}return r.onreadystatechange=function(e){if(4===r.readyState&&r.responseText){var n=r.status;if(n>=200&&n<300||304===n){if(t.success.call(m.root,r.responseText,r,e),t.cache){var i=JSON.parse(A.getItem("aixcache"));i[t.url||m.root.location.href.split("#")[0]]=r.responseText,A.setItem("aixcache",JSON.stringify(i))}}else t.fail.call(m.root,r,e)}},r.send(t.param?m.isObject(t.param)?m.datamime(t.header,t.param):t.param:null),T++,t.timeout&&m.async(function(){r.abort(),t.fail.call(m.root,r)},1e3*t.timeout||5e3),r},aixp:function(e){var t=m.compose({url:"",param:m.broken,key:"callback",fn:("jsonp"+Math.random()).replace(".",""),timeout:5,success:m.NULL,fail:m.NULL},e||{}),n=t.url+"?"+m.paramstringify(t.param)+(m.keys(t.param).length?"&":"")+t.key+"="+t.fn,i=m.root.document.createElement("script");i.src=n,m.root[t.fn]=function(e){clearTimeout(t.timesetup),m.root.document.body.removeChild(i),m.root[t.fn]=null,t.success.call(m.root,e)},m.root.document.body.append(i),t.timeout&&(t.timesetup=setTimeout(function(){m.root.document.body.removeChild(i),m.root[t.fn]=null,t.success.call(m.root)},1e3*t.timeout)),T++},pagepref:function(){var e=m.slice(document.getElementsByTagName("*")),t="",n={},i="",r={},o="",a="",s=m.slice(document.getElementsByTagName("img")),u=[],c=m.slice(document.getElementsByTagName("script")),l=function(e,t,n){e[n]?e[n].push(t):e[n]=[t]};m.foreach(e,function(e){var s=e.getAttribute("class");s&&(i+=" "+s,s=m.trim(s).split(" "),m.foreach(s,function(t){l(r,e,t)})),s=e.getAttribute("id"),s&&(t+=" "+s,s=m.trim(s),l(n,e,s)),s=m.root.getComputedStyle(e),s&&s.backgroundImage&&"none"!==s.backgroundImage.toLowerCase()&&(a+=" "+s.backgroundImage),s=e.getAttribute("href"),s&&(o+=" "+s)}),m.foreach(s,function(e){var t=e.getAttribute("src");t&&(a+=" "+t)}),m.foreach(c,function(e){var t=e.getAttribute("src");t&&u.push(t.split("/").pop().slice(0,-3))});var f=t.split(" ");f.shift(),f=m.unique(f);var h=i.split(" ");h.shift(),h=m.unique(h);var d=a.split(" ");d.shift(),d=m.unique(d);var p=o.split(" ");return p.shift(),p=m.unique(p),{_url:window.location.href,htmlsize:(document.body.innerHTML+document.head.innerHTML).replace(g,"").length,htmltags:e.length,idlist:f.sort(),idchecker:n,classlist:h.sort(),classchecker:r,scriptlist:u,imglist:d.sort(),linklist:p.sort(),cookies:m.cookie(),localstorage:A||{},_aixxhr:T}},ua:w})}var D;m.stack=D=function(e){var t=e||[],n=[];m.foreach(t,function(e){var t=m.isObject(e)?m.toarray(e):e||[],i=m.isFunction(t[0])?t[0]:m.NULL,r=m.isNumber(t[1])?t[1]:0,o=function(e){setTimeout(function(){var t=n.pop(),r=i.call(m.root,e);t&&t.call(m.root,r)},1e3*r)};n.push(o)}),m.define(this,"=",{value:n,writable:!0,enumerable:!1,configurable:!1})},m.extend(D.prototype,{noop:function(){return this["="]=[],this},fire:function(){return this["="].length&&this["="].pop().call(m.root)},add:function(){return this.push.apply(this,m.slice(arguments))},push:function(){var e=this,t=m.slice(arguments);m.foreach(t,function(t){if(!m.isFunction(t)&&!m.isArray(t))return console.error("add/push arguments error when assign to stack!");var n=m.isArray(t)?t[0]:t,i=m.isArray(t)?t[1]||0:parseFloat(t||0),r=function(t){setTimeout(function(){var i=e["="].pop(),r=n.call(m.root,t);i&&i.call(m.root,r)},1e3*i)};e["="].push(r)})}});var V;return m.hack=V=function(e,t){var n=this,i=e||[],r=i.length,o=new Array(r),a=[];m.define(this,{complete:{value:t||m.NULL,writable:!0,enumerable:!1,configurable:!1},"-":{value:a,writable:!0,enumerable:!1,configurable:!1}}),m.foreach(i,function(e,t){var i=t,r=m.isObject(e)?m.toarray(e):e||[],s=m.isFunction(r[0])?r[0]:m.NULL,u=m.isNumber(r[1])?r[1]:0,c=function(){setTimeout(function(){var e=s();o[i]=e||1,m.has(o)||(n.complete.apply(m.root,o),n.noop())},1e3*u)};a.push(c)})},m.extend(V.prototype,{noop:function(){return this["-"]=null,this.complete=null,this},fire:function(){return this["-"].length?m.foreach(this["-"],function(e){return e.call(m.root)}):0}}),m}),function(e,t){"function"==typeof define&&define.amd?define(["_"],t):e.__=t(_)}(this,function(e){"use strict";function t(){h||(h=!0,p.forEach(function(t,n){t.fn.call(e.root,t.ct)}),p=[])}function n(e){m.length>=v.config.limit&&m.shift(),m.push(e)}function i(t){return t.$el.every(function(t){return e.ua.browser.IE?document.body.contains(t):document.contains(t)})}function r(t){t=e.strip(e.trim(t));var n=[],i=!N.test(t),o=!E.test(t);if(i&&o)if(t.search(",")>-1)e.foreach(t.split(","),function(e){n=n.concat(r(e))});else{if(g.test(t))return[document.getElementById(t.substr(1))];if(_.test(t))n=document.getElementsByClassName(t.substr(1));else if(b.test(t))n=document.getElementsByTagName(t);else{if(y.test(t)){var a=y.exec(t),s=a[1],u=a[2],c=a[3];return null==s?e.slice(document.getElementsByTagName("*")).filter(function(e){return e.getAttribute(u)===c}):r(s).filter(function(e){return e.getAttribute(u)===c})}if(x.test(t)){var l=document.createElement("i");return l.innerHTML=t,n=e.slice(l.childNodes),n.filter(function(e){return 1===e.nodeType})}n=document.querySelectorAll(t)}}else{if(x.test(t)){var l=document.createElement("i");return l.innerHTML=t,n=e.slice(l.childNodes),n.filter(function(e){return 1===e.nodeType})}n=document.querySelectorAll(t)}return e.slice(n)}function o(e){if(e.search("rgb")!=-1){var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+u(t[1])+u(t[2])+u(t[3])}return e}function a(e){if(e.search("-")!=-1){for(var t=e.split("-"),n=1,i=t.length;n<i;n++)t[n]=t[n].charAt(0).toUpperCase()+t[n].slice(1);return t.join("")}return e}function s(t){return e.has(A,a(t))?"":"px"}function u(e){return("0"+parseInt(e).toString(16)).slice(-2)}function c(e){if(null==e)return e;var t=e.nextSibling;return null!=t&&1===t.nodeType?t:c(t)}function l(t,n,i,r){var o,a=e.isObject(r)?r:new CustomEvent(n,{data:i,bubbles:!0,cancelable:!0,target:t,toElement:t,srcElement:t,currentTarget:t});return e.isObject(r)&&(o={},o.data=i),null!=o?new L.Events(a,o):a}function f(e,t,n){!function(i){e[t]=e[n],e[n]=i}(e[t])}var h=!1,d=!1,p=[],m=[],v=function(n,r){if(e.isFunction(n))return h?setTimeout(function(){n(r)},0):(p.push({fn:n,ct:r}),"complete"===document.readyState?setTimeout(t,0):d||document.addEventListener("DOMContentLoaded",t,!1),void(d=!0));if(n instanceof w)return n;if(e.isString(n)){var o;if(m.forEach(function(e){e.$indicator===n&&(o=e)}),null!=o&&i(o))return e.clonedoom(o)}return new w(n)};v.config={limit:4,version:e.version};var g=/^#[^\s\=\+\.\#\[\]]+/i,_=/^\.[^\s\=\+\.\#\[\]]+$/i,b=/^[^\[\]\+\-\.#\s\=]+$/i,y=/([^\s]+)?\[([^\s]+)=["']?([^\s'"]+)["']?\]$/i,N=/[\s|\r]+/im,E=/[>|\+|\~]+/im,x=/\<[a-zA-Z][\s\S]*\>/,w=function(t){this.$el=[],null!=t&&(e.isString(t)?(this.$el=r(t),this.$indicator=t):t!==document&&t!==e.root&&1!==t.nodeType||(this.$el.push(t),this.$indicator="")),this.length=this.$el.length,n(e.clonedoom(this))};v.fn=w.prototype={constructor:w,version:e.version,extend:function(t){e.extend(this,t)}},v.fn.extend({each:function(t,n){return e.foreach(this.$el,t,n||this),this},get:function(t){return this.$el[+t+(t<0?this.length:0)]||e.slice(this.$el)},at:function(t){if(this.length){var n=e.clonedoom(this);return t=+t+(t<0?n.length:0),n.$el=[n.$el[t]],n.$el.length=1,n}return this},first:function(){return this.at(0)},last:function(){return this.at(-1)},add:function(){return this.compose.apply(this,e.slice(arguments))},compose:function(t){return null!=t&&(t instanceof w?this.$el=e.unique(this.$el.concat(t.$el||[])):e.isString(t)&&(this.$el=e.unique(this.$el.concat(v(t).$el)))),this.length=this.$el.length,this},by:function(t){var n=e.clonedoom(this);return n.$el=n.$el.filter(t),n.length=n.$el.length,n},even:function(){return this.by(function(e,t){return t%2!=0})},odd:function(){return this.by(function(e,t){return t%2==0})},next:function(t){var n=e.clonedoom(this),i=[],r=t?"previousElementSibling":"nextElementSibling";return e.foreach(n.$el,function(e){null!=e[r]&&i.push(e[r])}),n.$el=e.filter(i,function(e){return 3!==e.nodeType&&8!==e.nodeType&&"SCRIPT"!==e.nodeName}),n.length=n.$el.length,n},prev:function(e){return this.next(!e)},find:function(t){var n=e.clonedoom(this),i=[];return e.foreach(n.$el,function(n){i=e.slice(n.querySelectorAll(t)).concat(i)}),n.$el=i,n.length=n.$el.length,n},siblings:function(){var t=e.clonedoom(this),n=[],i=t.$el;return e.foreach(t.$el,function(t){n=e.slice(t.parentNode.children).concat(n)}),t.$el=e.filter(e.unique(n),function(t){return!e.has(i,t)}),t.length=t.$el.length,t},childrens:function(){var t=e.clonedoom(this),n=[];return e.foreach(t.$el,function(t){n=e.slice(t.children).concat(n)}),t.$el=e.unique(n),t.length=t.$el.length,t},parents:function(){var t=e.clonedoom(this),n=[];return e.foreach(t.$el,function(e){for(var t=[],i=e;i;)t.push(i.parentNode),i=i.parentNode;n=n.concat(t)}),t.$el=e.unique(n),t.length=t.$el.length,t}});var T=["checked","disabled","readonly","required","validate"],A=["zIndex","lineHeight"];v.fn.extend({addClass:function(t){return this.each(function(n){var i=n.getAttribute("class");i?(i=i.split(" "),n.setAttribute("class",e.unique(i.concat(t.split(" "))).join(" "))):n.setAttribute("class",e.unique(t.split(" ")).join(" "))})},removeClass:function(t){return this.each(function(n){var i=n.getAttribute("class");i&&(i=i.split(" "),e.foreach(t.split(" "),function(t){e.not(i,t)}),n.setAttribute("class",i.join(" ")))})},toggleClass:function(t){return this.each(function(n){var i=n.getAttribute("class");i?(i=i.split(" "),e.foreach(e.unique(t.split(" ")),function(t){e.has(i,t)?e.not(i,t):i.push(t)}),n.setAttribute("class",i.join(" "))):n.setAttribute("class",t)})},attr:function(){var t=e.slice(arguments);if(t.length){if(1===t.length)return this.get(0).getAttribute(t[0]);this.each(function(e){e.setAttribute(t[0],null!=t[1]?t[1].toString():"")})}return this},removeAttr:function(e){return this.each(function(t){t.removeAttribute(e)})},data:function(){var t=e.slice(arguments);return t[0]?(t[0]="data-"+t[0],this.attr.apply(this,t)):this},prop:function(){var t=e.slice(arguments);return t.length?1===t.length?e[e.has(T,t[0])?"isString":"cool"](this.attr(t[0])):t[1]!==!1&&0!==t[1]?this.attr(t[0],e.has(T,t[0])?"":t[1]):this.removeAttr(t[0]):this},removeProp:function(e){return this.removeAttr(e)},value:function(t){if(e.slice(arguments).length)return this.each(function(n){var i=n.tagName.toUpperCase();"SELECT"===i?e.foreach(e.slice(n.options),function(e){e.removeAttribute("selected"),(e.getAttribute("value")||e.innerText)===t+""&&e.setAttribute("selected","")}):n.setAttribute("value",t)});var n=this.get(0);return"SELECT"===n.tagName.toUpperCase()?n.options[n.selectedIndex].value||n.innerText:n.value||""},text:function(t){return null!=t?this.each(function(e){e.innerText=t+""}):e.decodeHTML(this.get(0).innerText||"")},fill:function(t){if(null!=t){var n="";return t.nodeType&&1===t.nodeType?n=t.outerHTML:e.isObject(t)&&t instanceof w?t.each(function(e){n+=e.outerHTML}):n=t+"",this.each(function(e){null!=e&&(e.innerHTML=n+"")})}var i=this.get(0);return null!=i.innerHTML?i.innerHTML:""},html:function(){return this.fill.apply(this,e.slice(arguments))},replacewith:function(e){var t=v(e);return this.each(function(e){t.each(function(t){e.parentNode.insertBefore(t,e)}),e.parentNode.removeChild(e)}),t},insertbefore:function(e){var t=v(e);return this.each(function(e){t.each(function(t){e.parentNode.insertBefore(t,e)})})},insertafter:function(e){var t=v(e);return this.each(function(e){t.each(function(t){var n=c(e);null!=n?e.parentNode.insertBefore(t,n):e.parentNode.appendChild(t)})})},append:function(e){var t=v(e);return this.each(function(e){t.each(function(t){e.appendChild(t)})})},remove:function(){return this.off().each(function(e){e.parentNode.removeChild(e)}),this.$el=[],this.length=0,this},empty:function(){return this.each(function(e){e.innerHTML=""})},offset:function(){var e=0,t=0,n=0,i=0,r=this.get(0);for(n=r.offsetWidth,i=r.offsetHeight;r;)t+=r.offsetLeft,e+=r.offsetTop,r=r.offsetParent;return{top:e,left:t,witdh:n,height:i}},pos:function(){var e=this.get(0);return{top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight}},draw:function(t,n){if(e.isString(t))return null==n?o(window.getComputedStyle(this.get(0),null)[t]):this.each(function(i){i.style[a(t)]=e.isNumber(n)?n+s(t):n||""});if(e.isObject(t))for(var i in t)this.draw(i,t[i]);return this},css:function(){return this.draw.apply(this,e.slice(arguments))},redraw:function(){return this.removeAttr("style")}});var L={};L.Events=function(t,n){for(var i in t)e.isFunction(t[i])||i===i.toUpperCase()||(this[i]=t[i]);this.data=n.data,e.define(this,"_event",{value:t,writable:!1,enumerable:!1,configurable:!0})},L.Events.consoda=["stopImmediatePropagation","stopPropagation","preventDefault"],L.Events.consoda.forEach(function(e){L.Events.prototype[e]=function(){return this._event[e]()}});var O,k=function(e){var t=this;Object.keys(e).forEach(function(n){t[n]=e[n]})};k.prototype={toString:function(){return JSON.stringify(this)}};var S=function(e,t){this.oldValue=e,this.newValue=t};S.prototype={contains:function(e){return e.length<this.length&&(e.newValue>=this.newValue&&e.newValue<this.newValue+this.length)},toString:function(){return this.length+" element subset, first mapping: old "+this.oldValue+" â†’ new "+this.newValue}};var D=function(e){var t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes.class&&t.push(e.nodeName+"."+e.attributes.class.replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id))),t},V=function(e){var t={},n={};return e.forEach(function(e){D(e).forEach(function(e){var i=e in t,r=e in n;i||r?i&&(delete t[e],n[e]=!0):t[e]=!0})}),t},F=function(t,n){var i=V(t),r=V(n),o={};return e.keys(i).forEach(function(e){r[e]&&(o[e]=!0)}),o},C=function(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(C)},U=function(e,t){var n,i;if(!["nodeName","value","checked","selected","data"].every(function(n){return e[n]===t[n]}))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){if(n=Object.keys(e.attributes),i=Object.keys(t.attributes),n.length!==i.length)return!1;if(!n.every(function(n){if(e.attributes[n]!==t.attributes[n])return!1}))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every(function(e,n){return U(e,t.childNodes[n])}))return!1}return!0},j=function(e,t,n,i,r){var o,a,s;if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!r||e.data===t.data;if(e.nodeName in n)return!0;if(e.attributes&&t.attributes){if(e.attributes.id&&e.attributes.id===t.attributes.id){var u=e.nodeName+"#"+e.attributes.id;if(u in n)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class){var c=e.nodeName+"."+e.attributes.class.replace(/ /g,".");if(c in n)return!0}}return!!i||(a=e.childNodes?e.childNodes.slice().reverse():[],s=t.childNodes?t.childNodes.slice().reverse():[],a.length===s.length&&(r?a.every(function(e,t){return e.nodeName===s[t].nodeName}):(o=F(a,s),a.every(function(e,t){return j(e,s[t],o,!0,!0)}))))},$=function(e,t,n,i){var r,o,a=0,s=[],u=Array.apply(null,new Array(e.length+1)).map(function(){return[]}),c=F(e,t),l=e.length===t.length;return l&&e.some(function(e,n){var i=D(e),r=D(t[n]);return i.length!==r.length?(l=!1,!0):(i.some(function(e,t){if(e!==r[t])return l=!1,!0}),!l||void 0)}),e.forEach(function(e,r){t.forEach(function(t,o){n[r]||i[o]||!j(e,t,c,l)?u[r+1][o+1]=0:(u[r+1][o+1]=u[r][o]?u[r][o]+1:1,u[r+1][o+1]>=a&&(a=u[r+1][o+1],s=[r+1,o+1]))})}),0!==a&&(r=[s[0]-a,s[1]-a],o=new S(r[0],r[1]),o.length=a,o)},I=function(e,t){return Array.apply(null,new Array(e)).map(function(){return t})},R=function(e,t,n){var i=e.childNodes?I(e.childNodes.length,!0):[],r=t.childNodes?I(t.childNodes.length,!0):[],o=0;return n.forEach(function(e){var t,n=e.oldValue+e.length,a=e.newValue+e.length;for(t=e.oldValue;t<n;t+=1)i[t]=o;for(t=e.newValue;t<a;t+=1)r[t]=o;o+=1}),{gaps1:i,gaps2:r}},M=function(e,t){for(var n=e.childNodes?e.childNodes:[],i=t.childNodes?t.childNodes:[],r=I(n.length,!1),o=I(i.length,!1),a=[],s=!0,u=function(){return arguments[1]},c=function(e){r[s.oldValue+e]=!0,o[s.newValue+e]=!0};s;)s=$(n,i,r,o),s&&(a.push(s),Array.apply(null,new Array(s.length)).map(u).forEach(c));return a},q=function(){this.list=[]};q.prototype={list:!1,add:function(e){var t=this.list;e.forEach(function(e){t.push(e)})},forEach:function(e){this.list.forEach(e)}};var H=function(e){var t,n={debug:!1,diffcap:10,maxDepth:!1,valueDiffing:!0,textDiff:function(){arguments[0].data=arguments[3]},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null};"undefined"==typeof e&&(e={});for(t in n)"undefined"==typeof e[t]?this[t]=n[t]:this[t]=e[t]};H.Diff=k,H.prototype={diff:function(e,t){var n=this.nodeToObj(e),i=this.nodeToObj(t);return O=0,this.debug&&(this.t1Orig=this.nodeToObj(e),
this.t2Orig=this.nodeToObj(t)),this.tracker=new q,this.findDiffs(n,i)},findDiffs:function(e,t){var n;do{if(this.debug&&(O+=1,O>this.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));n=this.findNextDiff(e,t,[]),0===n.length&&(U(e,t)||(C(e),n=this.findNextDiff(e,t,[]))),n.length>0&&(this.tracker.add(n),this.applyVirtual(e,n))}while(n.length>0);return this.tracker.list},findNextDiff:function(e,t,n){var i,r;if(this.maxDepth&&n.length>this.maxDepth)return[];if(!e.outerDone){if(i=this.findOuterDiff(e,t,n),this.filterOuterDiff&&(r=this.filterOuterDiff(e,t,i),r&&(i=r)),i.length>0)return e.outerDone=!0,i;e.outerDone=!0}if(!e.innerDone){if(i=this.findInnerDiff(e,t,n),i.length>0)return i;e.innerDone=!0}if(this.valueDiffing&&!e.valueDone){if(i=this.findValueDiff(e,t,n),i.length>0)return e.valueDone=!0,i;e.valueDone=!0}return[]},findOuterDiff:function(t,n,i){var r,o,a=[];return t.nodeName!==n.nodeName?[new k({action:"replaceElement",oldValue:e.clonedoom(t),newValue:e.clonedoom(n),route:i})]:t.data!==n.data?"#text"===t.nodeName?[new k({action:"modifyTextElement",route:i,oldValue:t.data,newValue:n.data})]:[new k({action:"modifyComment",route:i,oldValue:t.data,newValue:n.data})]:(r=t.attributes?Object.keys(t.attributes).sort():[],o=n.attributes?Object.keys(n.attributes).sort():[],r.forEach(function(e){var r=o.indexOf(e);r===-1?a.push(new k({action:"removeAttribute",route:i,name:e,value:t.attributes[e]})):(o.splice(r,1),t.attributes[e]!==n.attributes[e]&&a.push(new k({action:"modifyAttribute",route:i,name:e,oldValue:t.attributes[e],newValue:n.attributes[e]})))}),o.forEach(function(e){a.push(new k({action:"addAttribute",route:i,name:e,value:n.attributes[e]}))}),a)},nodeToObj:function(e){var t={},n=this;return t.nodeName=e.nodeName,"#text"===t.nodeName||"#comment"===t.nodeName?t.data=e.data:(e.attributes&&e.attributes.length>0&&(t.attributes={},Array.prototype.slice.call(e.attributes).forEach(function(e){t.attributes[e.name]=e.value})),e.childNodes&&e.childNodes.length>0&&(t.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(function(e){t.childNodes.push(n.nodeToObj(e))})),this.valueDiffing&&(void 0!==e.value&&(t.value=e.value),void 0!==e.checked&&(t.checked=e.checked),void 0!==e.selected&&(t.selected=e.selected))),t},objToNode:function(e,t){var n,i=this;return"#text"===e.nodeName?n=document.createTextNode(e.data):"#comment"===e.nodeName?n=document.createComment(e.data):("svg"===e.nodeName||t?(n=document.createElementNS("http://www.w3.org/2000/svg",e.nodeName),t=!0):n=document.createElement(e.nodeName),e.attributes&&Object.keys(e.attributes).forEach(function(t){n.setAttribute(t,e.attributes[t])}),e.childNodes&&e.childNodes.forEach(function(e){n.appendChild(i.objToNode(e,t))}),this.valueDiffing&&(e.value&&(n.value=e.value),e.checked&&(n.checked=e.checked),e.selected&&(n.selected=e.selected))),n},findInnerDiff:function(t,n,i){var r,o,a,s,u,c=t.childNodes&&n.childNodes?M(t,n):[],l=t.childNodes?t.childNodes:[],f=n.childNodes?n.childNodes:[],h=[],d=0;if(c.length>0&&(h=this.attemptGroupRelocation(t,n,c,i),h.length>0))return h;for(o=Math.max(l.length,f.length),l.length!==f.length&&(r=!0),u=0;u<o;u+=1)a=l[u],s=f[u],r&&(a&&!s?"#text"===a.nodeName?(h.push(new k({action:"removeTextElement",route:i.concat(d),value:a.data})),d-=1):(h.push(new k({action:"removeElement",route:i.concat(d),element:e.clonedoom(a)})),d-=1):s&&!a&&("#text"===s.nodeName?h.push(new k({action:"addTextElement",route:i.concat(d),value:s.data})):h.push(new k({action:"addElement",route:i.concat(d),element:e.clonedoom(s)})))),a&&s&&(h=h.concat(this.findNextDiff(a,s,i.concat(d)))),d+=1;return t.innerDone=!0,h},attemptGroupRelocation:function(t,n,i,r){var o,a,s,u,c,l,f,h,d,p=R(t,n,i),m=p.gaps1,v=p.gaps2,g=Math.min(m.length,v.length),_=[];for(h=0,f=0;h<g;f+=1,h+=1)if(m[h]===!0)if(u=t.childNodes[f],"#text"===u.nodeName){if("#text"===n.childNodes[h].nodeName&&u.data!==n.childNodes[h].data){for(l=f;t.childNodes.length>l+1&&"#text"===t.childNodes[l+1].nodeName;)if(l+=1,n.childNodes[h].data===t.childNodes[l].data){c=!0;break}if(!c)return _.push(new k({action:"modifyTextElement",route:r.concat(h),oldValue:u.data,newValue:n.childNodes[h].data})),_}_.push(new k({action:"removeTextElement",route:r.concat(h),value:u.data})),m.splice(h,1),g=Math.min(m.length,v.length),h-=1}else _.push(new k({action:"removeElement",route:r.concat(h),element:e.clonedoom(u)})),m.splice(h,1),g=Math.min(m.length,v.length),h-=1;else if(v[h]===!0)u=n.childNodes[h],"#text"===u.nodeName?(_.push(new k({action:"addTextElement",route:r.concat(h),value:u.data})),m.splice(h,0,!0),g=Math.min(m.length,v.length),f-=1):(_.push(new k({action:"addElement",route:r.concat(h),element:e.clonedoom(u)})),m.splice(h,0,!0),g=Math.min(m.length,v.length),f-=1);else if(m[h]!==v[h]){if(_.length>0)return _;if(s=i[m[h]],a=Math.min(s.newValue,t.childNodes.length-s.length),a!==s.oldValue){for(o=!1,d=0;d<s.length;d+=1)j(t.childNodes[a+d],t.childNodes[s.oldValue+d],[],!1,!0)||(o=!0);if(o)return[new k({action:"relocateGroup",groupLength:s.length,from:s.oldValue,to:a,route:r})]}}return _},findValueDiff:function(e,t,n){var i=[];return e.selected!==t.selected&&i.push(new k({action:"modifySelected",oldValue:e.selected,newValue:t.selected,route:n})),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&i.push(new k({action:"modifyValue",oldValue:e.value,newValue:t.value,route:n})),e.checked!==t.checked&&i.push(new k({action:"modifyChecked",oldValue:e.checked,newValue:t.checked,route:n})),i},applyVirtual:function(e,t){var n=this;return 0===t.length||(t.forEach(function(t){n.applyVirtualDiff(e,t)}),!0)},getFromVirtualRoute:function(e,t){var n,i,r=e;for(t=t.slice();t.length>0;){if(!r.childNodes)return!1;i=t.splice(0,1)[0],n=r,r=r.childNodes[i]}return{node:r,parentNode:n,nodeIndex:i}},applyVirtualDiff:function(t,n){var i,r,o,a=this.getFromVirtualRoute(t,n.route),s=a.node,u=a.parentNode,c=a.nodeIndex,l={diff:n,node:s};if(this.preVirtualDiffApply(l))return!0;switch(n.action){case"addAttribute":s.attributes||(s.attributes={}),s.attributes[n.name]=n.value,"checked"===n.name?s.checked=!0:"selected"===n.name?s.selected=!0:"INPUT"===s.nodeName&&"value"===n.name&&(s.value=n.value);break;case"modifyAttribute":s.attributes[n.name]=n.newValue,"INPUT"===s.nodeName&&"value"===n.name&&(s.value=n.value);break;case"removeAttribute":delete s.attributes[n.name],0===Object.keys(s.attributes).length&&delete s.attributes,"checked"===n.name?s.checked=!1:"selected"===n.name?delete s.selected:"INPUT"===s.nodeName&&"value"===n.name&&delete s.value;break;case"modifyTextElement":s.data=n.newValue,"TEXTAREA"===u.nodeName&&(u.value=n.newValue);break;case"modifyValue":s.value=n.newValue;break;case"modifyComment":s.data=n.newValue;break;case"modifyChecked":s.checked=n.newValue;break;case"modifySelected":s.selected=n.newValue;break;case"replaceElement":i=e.clonedoom(n.newValue),i.outerDone=!0,i.innerDone=!0,i.valueDone=!0,u.childNodes[c]=i;break;case"relocateGroup":s.childNodes.splice(n.from,n.groupLength).reverse().forEach(function(e){s.childNodes.splice(n.to,0,e)});break;case"removeElement":u.childNodes.splice(c,1);break;case"addElement":r=n.route.slice(),o=r.splice(r.length-1,1)[0],s=this.getFromVirtualRoute(t,r).node,i=e.clonedoom(n.element),i.outerDone=!0,i.innerDone=!0,i.valueDone=!0,s.childNodes||(s.childNodes=[]),o>=s.childNodes.length?s.childNodes.push(i):s.childNodes.splice(o,0,i);break;case"removeTextElement":u.childNodes.splice(c,1),"TEXTAREA"===u.nodeName&&delete u.value;break;case"addTextElement":r=n.route.slice(),o=r.splice(r.length-1,1)[0],i={},i.nodeName="#text",i.data=n.value,s=this.getFromVirtualRoute(t,r).node,s.childNodes||(s.childNodes=[]),o>=s.childNodes.length?s.childNodes.push(i):s.childNodes.splice(o,0,i),"TEXTAREA"===s.nodeName&&(s.value=n.newValue);break;default:console.log("unknown action")}l.newNode=i,this.postVirtualDiffApply(l)},apply:function(e,t){var n=this;return 0===t.length||(t.forEach(function(t){if(!n.applyDiff(e,t))return!1}),!0)},getFromRoute:function(e,t){t=t.slice();for(var n,i=e;t.length>0;){if(!i.childNodes)return!1;n=t.splice(0,1)[0],i=i.childNodes[n]}return i},applyDiff:function(e,t){var n,i,r,o,a=this.getFromRoute(e,t.route),s={diff:t,node:a};if(this.preDiffApply(s))return!0;switch(t.action){case"addAttribute":if(!a||!a.setAttribute)return!1;a.setAttribute(t.name,t.value);break;case"modifyAttribute":if(!a||!a.setAttribute)return!1;a.setAttribute(t.name,t.newValue);break;case"removeAttribute":if(!a||!a.removeAttribute)return!1;a.removeAttribute(t.name);break;case"modifyTextElement":if(!a||3!==a.nodeType)return!1;this.textDiff(a,a.data,t.oldValue,t.newValue);break;case"modifyValue":if(!a||"undefined"==typeof a.value)return!1;a.value=t.newValue;break;case"modifyComment":if(!a||"undefined"==typeof a.data)return!1;this.textDiff(a,a.data,t.oldValue,t.newValue);break;case"modifyChecked":if(!a||"undefined"==typeof a.checked)return!1;a.checked=t.newValue;break;case"modifySelected":if(!a||"undefined"==typeof a.selected)return!1;a.selected=t.newValue;break;case"replaceElement":a.parentNode.replaceChild(this.objToNode(t.newValue,"http://www.w3.org/2000/svg"===a.namespaceURI),a);break;case"relocateGroup":Array.apply(null,new Array(t.groupLength)).map(function(){return a.removeChild(a.childNodes[t.from])}).forEach(function(e,n){0===n&&(i=a.childNodes[t.to]),a.insertBefore(e,i)});break;case"removeElement":a.parentNode.removeChild(a);break;case"addElement":r=t.route.slice(),o=r.splice(r.length-1,1)[0],a=this.getFromRoute(e,r),a.insertBefore(this.objToNode(t.element,"http://www.w3.org/2000/svg"===a.namespaceURI),a.childNodes[o]);break;case"removeTextElement":if(!a||3!==a.nodeType)return!1;a.parentNode.removeChild(a);break;case"addTextElement":if(r=t.route.slice(),o=r.splice(r.length-1,1)[0],n=document.createTextNode(t.value),a=this.getFromRoute(e,r),!a||!a.childNodes)return!1;a.insertBefore(n,a.childNodes[o]);break;default:console.log("unknown action")}return s.newNode=n,this.postDiffApply(s),!0},undo:function(t,n){n=e.slice(n);var i=this;n.length||(n=[n]),n.reverse(),n.forEach(function(e){i.undoDiff(t,e)})},undoDiff:function(e,t){switch(t.action){case"addAttribute":t.action="removeAttribute",this.applyDiff(e,t);break;case"modifyAttribute":f(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"removeAttribute":t.action="addAttribute",this.applyDiff(e,t);break;case"modifyTextElement":f(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"modifyValue":f(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"modifyComment":f(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"modifyChecked":f(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"modifySelected":f(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"replaceElement":f(t,"oldValue","newValue"),this.applyDiff(e,t);break;case"relocateGroup":f(t,"from","to"),this.applyDiff(e,t);break;case"removeElement":t.action="addElement",this.applyDiff(e,t);break;case"addElement":t.action="removeElement",this.applyDiff(e,t);break;case"removeTextElement":t.action="addTextElement",this.applyDiff(e,t);break;case"addTextElement":t.action="removeTextElement",this.applyDiff(e,t);break;default:console.log("unknown action")}}};var P=new H({debug:!0,diffcap:99999});return v.fn.extend({reg:function(t,n,i,r,o){return e.isFunction(n)&&(o=r,r=i,i=n,n=null),this.each(function(a){if(null==a._events&&e.define(a,"_events",{value:{},writable:!0,enumerable:!1,configurable:!0}),null!=i){var s=function(e){var o=l(a,t,n,e);i.call(r||a,o,t,r)};s.fn=i.fn||i,s.cal=i,null==a._events[t]&&(a._events[t]=[]),a._events[t].push(s),a.addEventListener(t,s,!!o)}})},purge:function(t,n){return this.each(function(i){e.isString(t)?null!=n?(null!=i._events[t]?(i.removeEventListener(t,e.cat(i._events[t],function(e){return e.fn===n})[0]||n),i._events[t].length||delete i._events[t]):i.removeEventListener(t,n),null!=i._events["_"+t]&&(document.documentElement.removeEventListener(t,e.cat(i._events["_"+t],function(e){return e.fn===n})[0].cal,!0),i._events["_"+t].length||delete i._events["_"+t])):null!=i._events&&(e.foreach(i._events[t],function(e){i.removeEventListener(t,e)}),e.foreach(i._events["_"+t],function(e){document.documentElement.removeEventListener(t,e.cal,!0)}),delete i._events["_"+t],delete i._events[t]):(i._events=i._events||{},e.foreach(i._events,function(t,n){n.search("_")!==-1?e.foreach(t,function(e){document.documentElement.removeEventListener(n.slice(1),e.cal,!0)}):e.foreach(t,function(e){i.removeEventListener(n,e)})}))})},live:function(t,n,i,r,o){var a,s=!e.isFunction(n);return e.isFunction(i)||(a=i,i=e.isFunction(r)?r:e.NULL,r=o),this.each(function(r){if(s){var o=function(o){for(var s,u=v(o.target||o.toElement),c=u.parents().add(u).get(),f=v(r).find(n).get(),h=0,d=f.length;h<d;h++)if(e.has(c,f[h])){s=f[h];break}if(s&&1===s.nodeType)return i.call(s,l(u.get(0),t,a,o),t)};o.fn=i,o.elm=r,v(r).reg("_"+t,o,null),document.documentElement.addEventListener(t,o,!0)}else v(r).reg(t,n,i)})},on:function(){return this.live.apply(this,e.slice(arguments))},off:function(e,t,n){return this.purge(e,n)},signet:function(t,n){return null!=t?null!=n?this.each(function(i){i[t]?i.name=n:e.define(i,t,{value:n,writable:!0,enumerable:!1,configurable:!0})}):this.get(0)[t]:this},once:function(t,n,i,r){return e.isFunction(n)&&(r=i,i=n,n=null),this.each(function(e){var r=function(o){i.call(e,l(e,t,n,o),t),e.removeEventListener(t,r),r=null};e.addEventListener(t,r)})},dispatch:function(t,n){return this.each(function(i){var r=l(i,t);return e.isFunction(n)?n.call(i,r):i.dispatchEvent(r)})}}),v.fn.extend({xRender:function(t){return this.each(function(n){this.apply(n,this.diff(n,e.virtualDOM(n,t.nodeType?t.outerHTML:t||"")))},P)}}),v}),function(e,t){"function"==typeof define&&define.amd?define(["_","__"],t):e.aix=t(_,__)}(this,function(_,$){"use strict";function _genertor_(e){return function(){var t=_.clonedoom(this.data),n=[t].concat(_.slice(arguments));return t=_[e].apply(t,n),_.isequal(t,this.data)||(this.data=t,this.dispatch(e,null,n)),this}}function _genertor_$(e){return function(){var t=_.clonedoom(this.data),n=[t].concat(_.slice(arguments));return _[e].apply(t,n)}}function _genertor__(e){return function(){var t=_.clonedoom(this.data),n=[t].concat(_.slice(arguments)),i=_[e].apply(t,n);return _.isequal(t,this.data)||(this.data=t,this.dispatch(e,null,n)),i}}function hackaix(e,t){var n=e.toString(),i=e.toString().replace(strip_comment,""),r=t.toString().replace(strip_comment,""),o=n.slice(n.indexOf("{")+1,n.lastIndexOf("}"));return i=i.slice(i.indexOf("(")+1,i.indexOf(")")).match(/([^\s,]+)/g)[0],r=r.slice(r.indexOf("(")+1,r.indexOf(")")).match(/([^\s,]+)/g)[0],[i||"",r||"",o]}function createExtend(origin){return function(def){var x=hackaix(aix[origin],aix[origin].extend),extend=eval("(function(ops){ var "+x[0]+"=_.extend(_.extend({},"+x[1]+"),ops||{}); "+x[2]+"})");return _.compose(extend.prototype,aix[origin].prototype),extend.prototype.constructor=extend,_.define(extend,"base",{value:aix[origin],writable:!1,enumerable:!1,configurable:!1}),extend}}function changeHash(e,t,n){_.foreach(this.routes,function(i,r){RegExp(r,"i").test(e)&&changeHashReg.call(this,i,[n,e,t,r])},this)}function changeHashReg(e,t){switch(_.typeof(e)){case"function":e.apply(this||_.root,t);break;default:_.foreach(_.isString(e)?e.split(","):e,function(e){this.actions[e].apply(this||_.root,t)},this)}}var aix={},AIX_VIEW_COUNT=0,AIX_MODELS_COUNT=0,AIX_COLLECTION_COUNT=0,AIX_VIEW_DEFAULT={el:"",template:""},AIX_ROUTE_DEFAULT={routes:{},actions:{}},AIX_MODELS_DEFAULT={data:""},AIX_COLLECTION_DEFAULT={data:[],model:0},RESTFUL_enable={get:"GET",put:"PUT",save:"POST",post:"POST",pull:"PULL",fetch:"FETCH",update:"UPDATE",delete:"DELETE"},RESTFUL_disable={get:"GET",put:"POST",save:"POST",post:"POST",pull:"POST",fetch:"GET",update:"POST",delete:"POST"},RESTFUL_LIST=RESTFUL_disable;aix.aixpref=function(){return{count:{views:AIX_VIEW_COUNT,models:AIX_MODELS_COUNT,collections:AIX_COLLECTION_COUNT}}},aix.config={restful:!1},_.watch(aix.config,"restful",function(e){return RESTFUL_LIST=e?RESTFUL_enable:RESTFUL_disable,e});var strip_comment=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;aix.model=function(e){e=e||{};var t=this;_.define(this,{aid:{value:"#"+ ++AIX_MODELS_COUNT,writable:!0,enumerable:!1},change:{value:!1,writable:!0,enumerable:!1}}),_.isObject(e.events)&&_.foreach(e.events,function(e,n){_.addEvent(t,n,e)}),_.isFunction(e.validate)&&_.define(t,"validate",{value:e.validate,writable:!1,enumerable:!1,configurable:!1}),delete e.validate,delete e.change,delete e.events,_.extend(t,_.extend(_.clone(AIX_MODELS_DEFAULT),e)),_.watch(t,"data",function(e,n){if(_.isFunction(t.validate)){var i=!0;return(_.isFunction(t.validate)?!t.validate.call(t,e):0)&&(i=!1),i?(_.isequal(e,n)||(_.dispatch(t,"change",null,[e,n]),t.change=!0),_.dispatch(t,"validate",null,[e,n]),_.dispatch(t,"validate:success",null,[e,n]),e):(_.dispatch(t,"validate",null,[e,n]),_.dispatch(t,"validate:fail",null,[e,n]),n)}return _.isequal(e,n)||(_.dispatch(t,"change",null,[e,n]),t.change=!0),e}),_.dispatch(t,"init")},aix.model.prototype={constructor:aix.model,get:function(e){return _.isString(e)||_.isNumber(e)?_.clone(this.data[e]||""):_.clone(this.data)},set:function(){var e=_.slice(arguments);return e.length>1?(this.dispatch("change",null,[e[1],this.data[e[0]]]),this.data[e[0]]=e[1]):this.data=e[0],this.dispatch("set",null,e)},addEvent:function(e,t){return _.isFunction(t)&&_.addEvent(this,e,t),this},removeEvent:function(e,t){return _.removeEvent(this,e,t)},dispatch:function(e,t,n){return _.dispatch(this,e,_.isFunction(t)?t:null,n)},trigger:function(e,t,n){return this.dispatch(e,t,n)},listen:function(e,t){return _.isObject(this.data)&&_.watch(this.data,e,t),this},unlisten:function(e){return _.isObject(this.data)&&_.unwatch(this.data,e),this},add:function(){var e=_.slice(arguments),t=_.clone(this.data),n=_.typeof(t);return _.foreach(e,function(e){switch(n){case"number":t+=_.isNumber(+e)?+e:0;break;case"string":t+=e.toString();break;case"array":t=t.concat(e);break;case"object":_.isObject(e)&&_.extend(t,e)}}),this.data=t,this.dispatch("add",null,e)},remove:function(){var e=_.slice(arguments),t=_.clone(this.data),n=_.typeof(t);return _.foreach(e,function(e){switch(n){case"string":t=t.replace(e.toString,"");break;case"array":_.isArray(e)?_.foreach(e,function(e){_.not(t,e)}):_.not(t,e);break;case"object":_.isArray(e)?_.foreach(e,function(e){delete t[e]}):delete t[e]}}),e.length?this.data=t:this.data=null,this.dispatch("remove",null,e)}},aix.collection=function(e){e=e||{};var t=this;_.define(t,{cid:{value:"#"+ ++AIX_COLLECTION_COUNT,writable:!0,enumerable:!1},change:{value:!1,writable:!0,enumerable:!1}}),_.isObject(e.events)&&_.foreach(e.events,function(e,n){_.addEvent(t,n,e)}),_.isFunction(e.validate)&&_.define(t,"validate",{value:e.validate,writable:!1,enumerable:!1,configurable:!1}),delete e.validate,delete e.change,delete e.events,_.extend(t,_.extend(_.clone(AIX_COLLECTION_DEFAULT),e)),t.model&&(t.data=_.filter(t.data,function(e){return e.constructor===t.model})),_.watch(t,"data",function(e,n){if(_.isArray(e)||(e=[e]),_.isFunction(t.validate)){var i=!0;return _.foreach(e,function(e){(t.model?e.constructor!==t.model:0)&&(i=!1),(_.isFunction(t.validate)?!t.validate.call(t,e):0)&&(i=!1)}),i?(_.isequal(e,n)||(_.dispatch(t,"change",null,[e,n]),t.change=!0),_.dispatch(t,"validate",null,[e,n]),_.dispatch(t,"validate:success",null,[e,n]),e):(_.dispatch(t,"validate",null,[e,n]),_.dispatch(t,"validate:fail",null,[e,n]),n)}return _.isequal(e,n)||(_.dispatch(t,"change",null,[e,n]),t.change=!0),e}),_.dispatch(t,"init")},aix.collection.prototype={constructor:aix.collection,addEvent:function(e,t){return _.isFunction(t)&&_.addEvent(this,e,t),this},removeEvent:function(e,t){return _.removeEvent(this,e,t)},listen:function(e,t){return _.isObject(this.data)&&_.watch(this.data,e,t),this},unlisten:function(e){return _.isObject(this.data)&&_.unwatch(this.data,e),this},add:function(){var e=this.data.length,t=_.slice(arguments),n=_.slice(this.data);return t.length&&(n=n.concat.apply(n,t)),_.isequal(this.data,n)?this:(this.data=n,this.data.length===e?this:this.dispatch("add",null,t))},remove:function(e){var t,n=this.data.length;return _.isString(e)?(t=_.slice(this.data),t=_.cat(t,function(t){return t.aid!=="#"+e})):_.isObject(e)&&(_.isFunction(this.model)?e instanceof this.model&&(t=_.slice(this.data),t=_.not(t,e)):(t=_.slice(this.data),t=_.not(t,e))),t?(this.data=t,this.data.length===n?this:this.dispatch("remove",null,[e])):this},get:function(e){return _.isNumber(e)?this.model?_.filter(this.data,function(t){return t.aid==="#"+e}):this.data[e]:_.isString(e)?this.model?_.pluck(this.parse(),e):_.pluck(this.data,e):_.slice(this.data)},set:function(e){return this.data=_.isArray(e)?e:[e],this.dispatch("set",null,[e])},dispatch:function(e,t,n){return _.dispatch(this,e,_.isFunction(t)?t:null,n)},trigger:function(e,t,n){return this.dispatch(e,t,n)}},_.foreach(["loop","foreach","splice","push","unshift","sort","unique","reject","find","filter","map","cat","groupby","toarray","forarray","pairs","not","hook","bale","pluck","reverse","shuffle","merge","compose"],function(e){aix.model.prototype[e]=_genertor_(e),aix.collection.prototype[e]=_genertor_(e)}),_.foreach(["keys","clone","contain","findindex","has","isequal","requery","typeof","combom"],function(e){aix.model.prototype[e]=_genertor_$(e),aix.collection.prototype[e]=_genertor_$(e)}),_.foreach(["pop","shift"],function(e){aix.model.prototype[e]=_genertor__(e),aix.collection.prototype[e]=_genertor__(e)}),_.extend(aix.model.prototype,{toJSON:function(){return _.isArray(this.data)||_.isObject(this.data)?JSON.stringify(this.data):this.data},parse:function(){return _.clone(this.data)},pipe:function(e,t,n,i,r,o){var a,s,u=this,c={type:RESTFUL_LIST[e.toLowerCase()],aysnc:!0},l=_.isFunction(n);_.isString(t)?(c.url=t,c.param=l?{}:n||{},a=l?n:i||_.NULL,s=l?i||_.NULL:r||_.NULL):_.isObject(t)?(c.url=u.url||"/",c.param=l?t:n||{},a=l?n:i||_.NULL,s=l?i||_.NULL:r||_.NULL):(c.url=u.url||"/",a=_.NULL,s=_.NULL),c.header=o||{},c.success=function(t,n,i){a.call(u,t,n,i),u.dispatch(e+":success",null,[t,n,i])},c.fail=function(t,n){s.call(u,t,n),u.dispatch(e+":fail",null,[t,n])};var f=_.aix(c);return this.dispatch(e,null,[f])},aget:function(e,t,n,i,r){return this.pipe.apply(this,["get",e||this.url||"",t,n,i,r])},fetch:function(e,t,n,i){return this.pipe.apply(this,["fetch",this.url||"",e,function(e,n,i){this.data=JSON.parse(e),(t||_.NULL).call(this,e,n,i)},n,i])},sync:function(){return this.fetch.apply(this,_.slice(arguments))},post:function(e,t,n,i,r){return this.pipe.apply(this,["post",e||this.url||"",t||this.parse(),n,i,r])},save:function(e,t,n){return this.pipe.apply(this,["save",this.url||"",this.parse(),e,t,n])}}),_.extend(aix.collection.prototype,{toJSON:function(){var e=[];return _.foreach(this.data,function(t){e.push(t.get?t.get():t)}),JSON.stringify(e)},parse:function(){return JSON.parse(this.toJSON())},pipe:function(e,t,n,i,r,o){var a,s,u=this,c={type:RESTFUL_LIST[e.toLowerCase()],aysnc:!0},l=_.isFunction(n);_.isString(t)?(c.url=t,c.param=l?{}:n||{},a=l?n:i||_.NULL,s=l?i||_.NULL:r||_.NULL):_.isObject(t)?(c.url=u.url||"/",c.param=l?t:n||{},a=l?n:i||_.NULL,s=l?i||_.NULL:r||_.NULL):(c.url=u.url||"/",a=_.NULL,s=_.NULL),c.header=o||{},c.success=function(t,n,i){a.call(u,t,n,i),u.dispatch(e+":success",null,[t,n,i])},c.fail=function(t,n){s.call(u,t,n),u.dispatch(e+":fail",null,[t,n])};var f=_.aix(c);return this.dispatch(e,null,[f])},aget:function(e,t,n,i,r){return this.pipe.apply(this,["get",e||this.url||"",t,n,i,r])},fetch:function(e,t,n,i){return this.pipe.apply(this,["fetch",this.url||"",e,function(e,n,i){var r=JSON.parse(e);this.model&&_.foreach(r,function(e,t){r[t]=new this.model({data:e})},this),this.data=r,(t||_.NULL).call(this,e,n,i)},n,i])},sync:function(){return this.fetch.apply(this,_.slice(arguments))},post:function(e,t,n,i,r){return this.pipe.apply(this,["post",e||this.url||"",t||this.parse(),n,i,r])},save:function(e,t,n){return this.pipe.apply(this,["save",this.url||"",this.parse(),e,t,n])}}),$=$||_.NULL,aix.view=function(e){if(e=e||{},!_.isString(e.el))return console.error("view must define its 'el' prop bind with elm (custom string)");var t=this;return _.define(t,{vid:{value:"#"+ ++AIX_VIEW_COUNT,writable:!0,enumerable:!1}}),_.isObject(e.events)&&_.foreach(e.events,function(n,i){var r=i.split(":");r.length>1?$(e.el).on(r[0],r[1],{self:this},n):_.addEvent(t,i,n)},this),e.template&&!_.isString(e.template)||(e.template=_.isFunction(e.build)?e.build.call(t,e.template||""):_.doom(e.template||"")),e.render&&_.isFunction(e.render)||(e.render=function(e){return $(this.el).html(this.template(e))&&this}),delete e.change,delete e.events,_.isString(e.url)?(_.aix({url:e.url,cache:!_.isBoolean(e.cache)||e.cache,success:function(n){e.template=_.isFunction(e.build)?e.build.call(t,n):_.doom(n),_.extend(t,_.extend(_.clone(AIX_VIEW_DEFAULT),e)),_.dispatch(t,"init")},fail:function(t){console.error("Fetch template url->["+e.url+"] has fail!"),console.log(t)}}),this):(_.extend(t,_.extend(_.clone(AIX_VIEW_DEFAULT),e)),void _.dispatch(t,"init"))},aix.view.prototype={addEvent:function(e,t){var n=e.split(":");return n.length>1?$(this.el).on(n[0],n[1],{self:this},t):_.addEvent(this,e,t),this},removeEvent:function(e,t){var n=e.split(":");return n.length>1?$(this.el).off(n[0],n[1],t):_.removeEvent(this,e,t),this},empty:function(){return $(this.el).empty(),this},release:function(){return $(this.el).off(),this},destroy:function(e){return $(this.el).off()[e?"remove":"empty"](),_.define(this,"el",{value:null,writable:!1,enumerable:!1,configurable:!1}),_.removeEvent(this)},dispatch:function(e,t,n){return _.dispatch(this,e,_.isFunction(t)?t:null,n)},trigger:function(){return this.dispatch.apply(this,_.slice(arguments))}};var getHash=aix.getHash=function(e){var t=e.search("#");return t>0?e.slice(t+1):""};return aix.route=function(e){e=e||{};var t=this;_.isObject(e.events)&&_.foreach(e.events,function(e,n){_.addEvent(t,n,e)}),delete e.events,_.extend(this,_.extend(_.clone(AIX_ROUTE_DEFAULT),e)),_.addEvent(this,"hashchange",changeHash),_.define(this,{history:{value:{old:"",now:_.root.location.href},writable:!0,enumerable:!1},rid:{value:"aix-route-"+Math.random(),writable:!1,enumerable:!1,configurable:!1},event:{value:function(e){return _.root.location.href===t.history.now?e.preventDefault():(t.history.old=t.history.now,t.history.now=_.root.location.href,_.dispatch(t,"hashchange",null,[getHash(_.root.location.href),getHash(t.history.old),e]))},writable:!1,enumerable:!1,configurable:!1}}),_.dispatch(t,"init")},aix.route.prototype={constructor:aix.route,addEvent:function(e,t){return _.isFunction(t)&&_.addEvent(this,e,t),this},removeEvent:function(e,t){return _.removeEvent(this,e,t)},dispatch:function(e,t,n){return _.dispatch(this,e,t,n)},addRoute:function(e,t){return(_.isString(t)||_.isArray(fnname))&&(this.routes[e]=fnname),this},removeRoute:function(e){return delete this.routes[e],this},addAction:function(e,t){return _.isString(e)&&isFunction(t)&&(this.actions[e]=t),this},removeAction:function(e){return delete this.actions[e],this},listen:function(){return this._listen||(_.define(this,"_listen",{value:1,writable:!1,enumerable:!1,configurable:!0}),_.root.addEventListener("hashchange",this.event),this.dispatch("listen"),this.dispatch("hashchange",null,[getHash(window.location.href)])),this},stop:function(){return delete this._listen&&(_.root.removeEventListener("hashchange",this.event),this.dispatch("stop")),this},assign:function(e){if(this._listen){var t=_.root.location.href,n=t.search("#");n>0&&(t=t.slice(0,n)),_.root.location.href=t+("#"===e.toString().slice(0,1)?"":"#")+e}return this},addhash:function(e){var t=_.root.location.href+(e||"").toString();return t!==_.root.location.href&&(_.root.location.href=t),this}},aix.model.extend=createExtend("model"),aix.collection.extend=createExtend("collection"),aix.view.extend=createExtend("view"),aix.route.extend=createExtend("route"),aix});