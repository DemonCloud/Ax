!(function(t,e,n){if("function"==typeof define&&define.amd)define("ax",["struct"],(function(t){return n(e,t)}));else if("undefined"!=typeof exports){var i=require("struct");n(exports,i)}else t.ax=n(e,t._)})(this,{},(function(t,e){"use strict";function n(t){return function(e){return new t(yt(e)?e:{})}}function i(t){return function(e){var n=e;return function(e){return new t(Zt(n,yt(e)?e:{}))}}}function o(t){return t._zid||(t._zid=ee++)}function s(t,e,n,i){if((e=r(e)).ns)var s=a(e.ns);return(ne[o(t)]||[]).filter((function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||s.test(t.ns))&&(!n||o(t.fn)===o(n))&&(!i||t.sel==i)}))}function r(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function a(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function u(t,e){return t.del&&!ie&&t.e in oe||!!e}function c(t){var e=0;if(null!=t.selectionStart)e=t.selectionStart;else if(document.selection){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),e=n.text.length}return e}function l(t,e){if(t.createTextRange){var n=t.createTextRange();n.move("character",e),n.select()}else t.selectionStart?t.setSelectionRange(e,e,t.focus()):t.focus()}function h(t){return se[t]||ae[t]||re[t]||ie&&oe[t]||t}function d(t,e,n,i,s,a,d){var f=o(t),p=ne[f]||(ne[f]=[]);Ot(e.split(/\s/),(function(e){var o=r(e);o.fn=n,o.sel=s,o.e in se&&(n=function(t){var e=t.relatedTarget;if(!e||e!==this&&!this.contains(e))return o.fn.apply(this,arguments)}),o.del=a;var f=a||n;o.proxy=function(e){var n,o=e.type,s=e.target.nodeName,r="true"===e.target.contentEditable,a=qt(ue,o)&&("INPUT"===s||"TEXTAREA"===s||r);if((e=v(e)).isImmediatePropagationStopped()||a&&e.target._compositionIn)return!1;qt(ce,o)||(e.data=i),a&&(n=c(e.target));var u=f.apply(t,void 0===e._args?[e]:[e].concat(e._args));return!1===u&&(e.preventDefault(),e.stopPropagation()),n&&l(e.target,n),u},o.i=p.length,p.push(o);var m=h(o.e);m in ae&&(t.addEventListener("compositionstart",(function(t){t.target._compositionIn=!0})),t.addEventListener("compositionend",(function(t){t.target._compositionIn=!1,X(t.target).trigger("input")}))),t.addEventListener(m,o.proxy,u(o,d))}))}function f(t,e,n,i,r){var a=o(t);Ot((e||"").split(/\s/),(function(e){Ot(s(t,e,n,i),(function(e){delete ne[a][e.i],t.removeEventListener(h(e.e),e.proxy,u(e,r))}))}))}function p(){return!0}function m(){return!1}function v(t,e){if(e||!t.isDefaultPrevented){e||(e=t),Ot(he,(function(n,i){var o=e[i];t[i]=function(){return this[n]=p,o&&o.apply(e,arguments)},t[n]=m}));try{t.timeStamp||(t.timeStamp=Date.now())}catch(t){}(void 0!==e.defaultPrevented?e.defaultPrevented:"returnValue"in e?!1===e.returnValue:e.getPreventDefault&&e.getPreventDefault())&&(t.isDefaultPrevented=p)}return t}function g(t){var e,n={originalEvent:t};for(e in t)le.test(e)||void 0===t[e]||(n[e]=t[e]);return v(n,t)}function y(t,e){this.oldValue=t,this.newValue=e}function _(t,e){for(var n=[],i=0;i<t;i++)n[i]=e;return n}function b(t,e){var n,i=t.cloneNode();return Te?i.appendChild((n=document.createElement("template"),n.innerHTML=e,n.content)):i.innerHTML=e,i}function N(t,e,n){var i=[],o=Ut(n);if(!o)return i;if(!mt(t,e))for(var s,r,a=ct(n),u=0;u<o;u++)if(s=n[a[u]],r=Lt(e,a[u]),!s(r)){i.push(a[u],r);break}return i}function V(t,e){return _t(e)&&jt(this,t,e),this}function w(t,e){return this.on(e,t)}function k(t,e){return Mt(this,t,e)}function x(t,e){return Ct(this,t,e||[])}function E(t,e){return kt(t)?t=t.concat(e):yt(t)?t=Zt(t,e):Vt(t)?t+=e:t=e,t}function D(t,e){return console.warn(Se({value:t,type:gt(t),msg:e||""})),!1}function T(t,e){return function(n){return t(n)||D(n,t({type:e}))}}function A(t){return function(e){return e instanceof t}}function S(t,e,n,i,o,s){var r={url:e,type:st[t],aysnc:!0,param:n,header:s};return r.success=function(){(i||lt).apply(this,arguments),this.emit(t+":success",arguments)}.bind(this),r.fail=function(){(o||lt).apply(this,arguments),this.emit(t+":fail",arguments)}.bind(this),this.emit(t,[Ht(r),r])}function O(t){return t.split("").reverse().join("")}function R(t,e){var n=$t(I(t),P(t,e),j(t));return function(){return n(arguments)}}function I(t){return function(e){return t.emit("beforeRender",e),e}}function P(t,e){return function(n){return e.apply(t,n),n}}function j(t){return function(e){return t.emit("completed",e),t}}function M(t,e){var n=R(t,e);return ht(t,"render",{get:function(){return n},set:function(e){return _t(e)&&(n=R(t,e)),n},enumerable:!0,configurable:!1}),t}function C(t){if(!At(t)&&!xt(t))throw new TypeError("el must be typeof DOMElement or NodeList collections -> not "+t);return!0}function L(t,e){var n=t.search("#"),i=t.search(e);return n>0?t.slice(n+1,~i?i:void 0):""}function z(t,e){var n=t.search(e);return Bt(~n?t.slice(n+1):void 0)}function F(t,e,n){var i=L(t,e),o=z(t,e);Rt(this.routes,(function(t,e){new RegExp(e,"i").test(i)&&B.call(this,t,[o,i,n])}),this)}function B(t,e){_t(t)?t.apply(this,e):It(Vt(t)?t.split(","):t,(function(t){this.actions[t].apply(this,e)}),this)}function G(t,e){return function(n){n[t].apply(n,e||[])}}function J(t){return function(e,n){return _t(e)&&n===Pe?e(t):[]}}function q(t){return t.name===this}function H(t,e){var n=this._assert(te,Pe),i=Vt(t)?[t]:kt(t)?t:[];return It(i,(function(t){e.call(this,n,t)}),this),this}function U(t,e){var n=[];switch(gt(e)){case"regexp":It(t,(function(t){e.test(t.name)&&n.push(t.name)}));break;case"string":n.push(e);break;case"array":n=e}return n}t.VERSION=e.VERSION;var X,K,$,Y,Z,Q,W,tt,et={},nt={use:[]},it={data:{},validate:{}},ot={char:"@",routes:{},actions:{}},st={get:"GET",put:"POST",send:"GET",sync:"POST",post:"POST",fetch:"GET",update:"POST"},rt=e.root,at=e.v8(),ut=e.lock(),ct=e.keys(),lt=e.noop(),ht=e.define(),dt=e.slice(),ft=e.clone(),pt=e.extend(),mt=e.eq(),vt=e.convert("string"),gt=e.type(),yt=e.type("object"),_t=e.type("function"),bt=e.type("num"),Nt=e.type("bool"),Vt=e.type("str"),wt=e.type("int"),kt=e.type("array"),xt=e.type("arraylike"),Et=e.type("primitive"),Dt=e.type("float"),Tt=e.type("dom"),At=e.type("elm"),St=e.type("node"),Ot=e.op(),Rt=e.op("object"),It=e.op("array"),Pt=(e.cat(),e.every()),jt=e.event("on"),Mt=e.event("unbind"),Ct=e.event("emit"),Lt=e.prop("get"),zt=e.prop("set"),Ft=e.prop("not"),Bt=e.param(),Gt=e.param("string"),Jt=e.string("trim"),qt=e.has(),Ht=e.ajax(),Ut=e.size(),Xt=e.first(),Kt=e.last(),$t=e.link(),Yt=(e.assembly("u2b"),e.assembly("b2u"),e.doom()),Zt=e.merge(),Qt=e.index(),Wt=e.index("one"),te=e.cool();K=function(t){this.el=xt(t)?dt(t):t instanceof Element?[t]:[]},X=function(t){return X.init.call(rt,t)};var ee=1,ne={},ie="onfocusin"in e.root,oe={focus:"focusin",blur:"focusout"},se={mouseenter:"mouseover",mouseleave:"mouseout"},re={check:"change"},ae={change:"input",input:"input"},ue=["input","keypress","keydown","keyup"],ce=["compositionstart","compositionupdate"].concat(["compositionend"]),le=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,he={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"},de=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||function(t){return null!=this.parentNode&&this!==document&&qt(this.parentNode.querySelectorAll(t),this)};X.init=function(t){return new K(t)},X.matchz=function(t,e){return!(null===t||t===document||"string"!=typeof e)&&de.call(t,e)},X.event={add:d,remove:f},X.proxy=function(t,e){var n=2 in arguments&&dt(arguments,2);if(_t(t)){var i=function(){return t.apply(e,n?n.concat(dt(arguments)):arguments)};return i._zid=o(t),i}if("string"==typeof e)return n?X.proxy.apply(null,(n.unshift(t[e],t),n)):X.proxy(t[e],t);throw new TypeError("expected function")},X.Event=function(t,e){"string"!=typeof t&&(e=t,t=e.type);var n=document.createEvent(qt(Ae.MouseEvent,t)?"MouseEvent":"Events"),i=!0;if(e)for(var o in e)"bubbles"===o?i=!!e[o]:n[o]=e[o];return n.initEvent(t,i,!0),v(n)};var fe,pe={addAttribute:0,modifyAttribute:1,removeAttribute:2,modifyTextElement:3,relocateGroup:4,removeElement:5,addElement:6,removeTextElement:7,addTextElement:8,replaceElement:9,modifyValue:10,modifyChecked:11,modifySelected:12,modifyComment:13,action:"a",route:"r",oldValue:"o",newValue:"n",element:"e",group:"g",from:"f",to:"t",name:"na",value:"v",data:"d",attributes:"at",nodeName:"nn",childNodes:"c",checked:"ch",selected:"s"},me=function(t){pt(this,t||{})};me.prototype={toString:function(){return JSON.stringify(this)},setValue:function(t,e){return this[t]=e,this}},y.prototype={contains:function(t){return t.length<this.length&&(t.newValue>=this.newValue&&t.newValue<this.newValue+this.length)},toString:function(){return this.length+" element subset, first mapping: old "+this.oldValue+" â†’ new "+this.newValue}};var ve=function(t){var e=[];return"#text"!==t.nodeName&&"#comment"!==t.nodeName&&(e.push(t.nodeName),t.attributes&&(t.attributes.class&&e.push(t.nodeName+"."+t.attributes.class.replace(/ /g,".")),t.attributes.id&&e.push(t.nodeName+"#"+t.attributes.id))),e},ge=function(t){var e={},n={};return It(t,(function(t){It(ve(t),(function(t){var i=t in e,o=t in n;i||o?i&&(n[t]=delete e[t]):e[t]=!0}))})),e},ye=function(t,e){var n=ge(t),i=ge(e),o={};return It(ct(n),(function(t){i[t]&&(o[t]=!0)})),o},_e=function(t){return delete t.outerDone,delete t.innerDone,delete t.valueDone,!t.childNodes||Pt(t.childNodes,_e)},be=function(t,e){if(!Pt(["nodeName","value","checked","selected","data"],(function(n){return t[n]===e[n]})))return!1;if(Boolean(t.attributes)!==Boolean(e.attributes)||Boolean(t.childNodes)!==Boolean(e.childNodes))return!1;if(t.attributes){var n,i;if(n=ct(t.attributes),i=ct(e.attributes),n.length!==i.length)return!1;if(!Pt(n,(function(n){return t.attributes[n]===e.attributes[n]})))return!1}if(t.childNodes){if(t.childNodes.length!==e.childNodes.length)return!1;if(!Pt(t.childNodes,(function(t,n){return be(t,e.childNodes[n])})))return!1}return!0},Ne=function(t,e,n,i,o){var s,r,a;if(!t||!e||t.nodeName!==e.nodeName)return!1;if("#text"===t.nodeName)return!!o||t.data===e.data;if(t.nodeName in n)return!0;if(t.attributes&&e.attributes){if(t.attributes.id&&t.attributes.id===e.attributes.id&&t.nodeName+"#"+t.attributes.id in n)return!0;if(t.attributes.class&&t.attributes.class===e.attributes.class&&t.nodeName+"."+t.attributes.class.replace(/ /g,".")in n)return!0}return!!i||(r=t.childNodes?t.childNodes.slice().reverse():[],a=e.childNodes?e.childNodes.slice().reverse():[],r.length===a.length&&(o?Pt(r,(function(t,e){return t.nodeName===a[e].nodeName})):(s=ye(r,a),Pt(r,(function(t,e){return Ne(t,a[e],s,!0,!0)})))))},Ve=function(t,e,n,i){var o,s,r=0,a=[],u=Array.apply(null,new Array(t.length+1)).map((function(){return[]})),c=ye(t,e),l=t.length===e.length;return l&&t.some((function(t,n){var i=ve(t),o=ve(e[n]);return i.length!==o.length?!(l=!1):(i.some((function(t,e){if(t!==o[e])return!(l=!1)})),!l)})),It(t,(function(t,o){It(e,(function(e,s){n[o]||i[s]||!Ne(t,e,c,l)?u[o+1][s+1]=0:(u[o+1][s+1]=u[o][s]?u[o][s]+1:1,u[o+1][s+1]>=r&&(r=u[o+1][s+1],a=[o+1,s+1]))}))})),0!==r&&(o=[a[0]-r,a[1]-r],s=new y(o[0],o[1]),s.length=r,s)},we=function(t,e,n){var i=t.childNodes?_(t.childNodes.length,!0):[],o=e.childNodes?_(e.childNodes.length,!0):[],s=0;return It(n,(function(t){var e,n=t.oldValue+t.length,r=t.newValue+t.length;for(e=t.oldValue;e<n;e++)i[e]=s;for(e=t.newValue;e<r;e++)o[e]=s;s++})),{gaps1:i,gaps2:o}},ke=function(t,e){for(var n=t.childNodes?t.childNodes:[],i=e.childNodes?e.childNodes:[],o=_(n.length,!1),s=_(i.length,!1),r=[],a=!0;a;)(a=Ve(n,i,o,s))&&It((r.push(a),Array.apply(null,new Array(a.length)).map((function(t,e){return e}))),(function(t){o[a.oldValue+t]=!0,s[a.newValue+t]=!0}));return r},xe=function(){this.list=[]};xe.prototype={list:!1,add:function(t){return It(t,(function(t){this.push(t)}),this.list)},forEach:function(t){It(this.list,t)}};var Ee=function(t){pt(this,pt({debug:!1,diffcap:10,maxDepth:!1,valueDiffing:!0,textDiff:function(){arguments[0].data=arguments[3]},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null},t||{})),this._const=Object.freeze(ft(pe))};Ee.Diff=me,Ee.prototype={diff:function(t,e){var n=this.nodeToObj(t),i=this.nodeToObj(e);return fe=0,this.debug&&(this.t1Orig=this.nodeToObj(t),this.t2Orig=this.nodeToObj(e)),this.tracker=new xe,this.findDiffs(n,i)},findDiffs:function(t,e){var n;do{0===(n=this.findNextDiff(t,e,[])).length&&(be(t,e)||(_e(t),n=this.findNextDiff(t,e,[]))),n.length>0&&this.applyVirtual(t,this.tracker.add(n))}while(n.length>0);return this.tracker.list},findNextDiff:function(t,e,n){var i,o;if(this.maxDepth&&n.length>this.maxDepth)return[];if(!t.outerDone){if(i=this.findOuterDiff(t,e,n),this.filterOuterDiff&&(o=this.filterOuterDiff(t,e,i))&&(i=o),i.length>0)return t.outerDone=!0,i;t.outerDone=!0}if(!t.innerDone){if((i=this.findInnerDiff(t,e,n)).length>0)return i;t.innerDone=!0}if(this.valueDiffing&&!t.valueDone){if((i=this.findValueDiff(t,e,n)).length>0)return t.valueDone=!0,i;t.valueDone=!0}return[]},findOuterDiff:function(t,e,n){var i,o,s=this,r=[];return t.nodeName!==e.nodeName?[(new me).setValue(s._const.action,s._const.replaceElement).setValue(s._const.oldValue,t).setValue(s._const.newValue,e).setValue(s._const.route,n)]:t.data!==e.data?"#text"===t.nodeName?[(new me).setValue(s._const.action,s._const.modifyTextElement).setValue(s._const.route,n).setValue(s._const.oldValue,t.data).setValue(s._const.newValue,e.data)]:[(new me).setValue(s._const.action,s._const.modifyComment).setValue(s._const.route,n).setValue(s._const.oldValue,t.data).setValue(s._const.newValue,e.data)]:(i=t.attributes?ct(t.attributes).sort():[],o=e.attributes?ct(e.attributes).sort():[],It(i,(function(i){var a=o.indexOf(i);-1===a?r.push((new me).setValue(s._const.action,s._const.removeAttribute).setValue(s._const.route,n).setValue(s._const.name,i).setValue(s._const.value,t.attributes[i])):(o.splice(a,1),t.attributes[i]!==e.attributes[i]&&r.push((new me).setValue(s._const.action,s._const.modifyAttribute).setValue(s._const.route,n).setValue(s._const.name,i).setValue(s._const.oldValue,t.attributes[i]).setValue(s._const.newValue,e.attributes[i])))})),It(o,(function(t){r.push((new me).setValue(s._const.action,s._const.addAttribute).setValue(s._const.route,n).setValue(s._const.name,t).setValue(s._const.value,e.attributes[t]))})),r)},nodeToObj:function(t){var e={};return e.nodeName=t.nodeName,"#text"===e.nodeName||"#comment"===e.nodeName?e.data=t.data:(t.attributes&&t.attributes.length>0&&(e.attributes={},It(Array.prototype.slice.call(t.attributes),(function(t){e.attributes[t.name]=t.value}))),t.childNodes&&t.childNodes.length>0&&(e.childNodes=[],It(Array.prototype.slice.call(t.childNodes),(function(t){e.childNodes.push(this.nodeToObj(t))}),this)),this.valueDiffing&&(void 0!==t.value&&(e.value=t.value),void 0!==t.checked&&(e.checked=t.checked),void 0!==t.selected&&(e.selected=t.selected))),e},objToNode:function(t,e){var n;return"#text"===t.nodeName?n=document.createTextNode(t.data):"#comment"===t.nodeName?n=document.createComment(t.data):("svg"===t.nodeName||e?(n=document.createElementNS("http://www.w3.org/2000/svg",t.nodeName),e=!0):n=document.createElement(t.nodeName),t.attributes&&It(ct(t.attributes),(function(e){n.setAttribute(e,t.attributes[e])})),t.childNodes&&It(t.childNodes,(function(t){n.appendChild(this.objToNode(t,e))}),this),this.valueDiffing&&(t.value&&(n.value=t.value),t.checked&&(n.checked=t.checked),t.selected&&(n.selected=t.selected))),n},findInnerDiff:function(t,e,n){var i,o,s,r,a,u=this,c=t.childNodes&&e.childNodes?ke(t,e):[],l=t.childNodes?t.childNodes:[],h=e.childNodes?e.childNodes:[],d=[],f=0;if(c.length>0&&(d=this.attemptGroupRelocation(t,e,c,n)).length>0)return d;for(o=Math.max(l.length,h.length),l.length!==h.length&&(i=!0),a=0;a<o;a+=1)s=l[a],r=h[a],i&&(s&&!r?"#text"===s.nodeName?(d.push((new me).setValue(u._const.action,u._const.removeTextElement).setValue(u._const.route,n.concat(f)).setValue(u._const.value,s.data)),f-=1):(d.push((new me).setValue(u._const.action,u._const.removeElement).setValue(u._const.route,n.concat(f)).setValue(u._const.element,s)),f-=1):r&&!s&&("#text"===r.nodeName?d.push((new me).setValue(u._const.action,u._const.addTextElement).setValue(u._const.route,n.concat(f)).setValue(u._const.value,r.data)):d.push((new me).setValue(u._const.action,u._const.addElement).setValue(u._const.route,n.concat(f)).setValue(u._const.element,r)))),s&&r&&(d=d.concat(this.findNextDiff(s,r,n.concat(f)))),f++;return t.innerDone=!0,d},attemptGroupRelocation:function(t,e,n,i){var o,s,r,a,u,c,l,h,d,f=this,p=we(t,e,n),m=p.gaps1,v=p.gaps2,g=Math.min(m.length,v.length),y=[];for(h=0,l=0;h<g;l+=1,h+=1)if(!0===m[h])if("#text"===(a=t.childNodes[l]).nodeName){if("#text"===e.childNodes[h].nodeName&&a.data!==e.childNodes[h].data){for(c=l;t.childNodes.length>c+1&&"#text"===t.childNodes[c+1].nodeName;)if(c+=1,e.childNodes[h].data===t.childNodes[c].data){u=!0;break}if(!u)return y.push((new me).setValue(f._const.action,f._const.modifyTextElement).setValue(f._const.route,i.concat(h)).setValue(f._const.oldValue,a.data).setValue(f._const.newValue,e.childNodes[h].data)),y}y.push((new me).setValue(f._const.action,f._const.removeTextElement).setValue(f._const.route,i.concat(h)).setValue(f._const.value,a.data)),m.splice(h,1),g=Math.min(m.length,v.length),h-=1}else y.push((new me).setValue(f._const.action,f._const.removeElement).setValue(f._const.route,i.concat(h)).setValue(f._const.element,a)),m.splice(h,1),g=Math.min(m.length,v.length),h--;else if(!0===v[h])"#text"===(a=e.childNodes[h]).nodeName?(y.push((new me).setValue(f._const.action,f._const.addTextElement).setValue(f._const.route,i.concat(h)).setValue(f._const.value,a.data)),m.splice(h,0,!0),g=Math.min(m.length,v.length),l--):(y.push((new me).setValue(f._const.action,f._const.addElement).setValue(f._const.route,i.concat(h)).setValue(f._const.element,a)),m.splice(h,0,!0),g=Math.min(m.length,v.length),l--);else if(m[h]!==v[h]){if(y.length>0)return y;if(r=n[m[h]],(s=Math.min(r.newValue,t.childNodes.length-r.length))!==r.oldValue){for(o=!1,d=0;d<r.length;d+=1)Ne(t.childNodes[s+d],t.childNodes[r.oldValue+d],[],!1,!0)||(o=!0);if(o)return[(new me).setValue(f._const.action,f._const.relocateGroup).setValue("groupLength",r.length).setValue(f._const.from,r.oldValue).setValue(f._const.to,s).setValue(f._const.route,i)]}}return y},findValueDiff:function(t,e,n){var i=[],o=this;return t.selected!==e.selected&&i.push((new me).setValue(o._const.action,o._const.modifySelected).setValue(o._const.oldValue,t.selected).setValue(o._const.newValue,e.selected).setValue(o._const.route,n)),(t.value||e.value)&&t.value!==e.value&&"OPTION"!==t.nodeName&&i.push((new me).setValue(o._const.action,o._const.modifyValue).setValue(o._const.oldValue,t.value).setValue(o._const.newValue,e.value).setValue(o._const.route,n)),t.checked!==e.checked&&i.push((new me).setValue(o._const.action,o._const.modifyChecked).setValue(o._const.oldValue,t.checked).setValue(o._const.newValue,e.checked).setValue(o._const.route,n)),i},applyVirtual:function(t,e){return It(e,(function(e){this.applyVirtualDiff(t,e)}),this),!0},getFromVirtualRoute:function(t,e){var n,i,o=t;for(e=e.slice();e.length>0;){if(!o.childNodes)return!1;i=e.splice(0,1)[0],n=o,o=o.childNodes[i]}return{node:o,parentNode:n,nodeIndex:i}},applyVirtualDiff:function(t,e){var n,i,o,s=this.getFromVirtualRoute(t,e[this._const.route]),r=s.node,a=s.parentNode,u=s.nodeIndex,c=this,l={diff:e,node:r};if(this.preVirtualDiffApply(l))return!0;switch(e[this._const.action]){case this._const.addAttribute:r.attributes||(r.attributes={}),r.attributes[e[this._const.name]]=e[this._const.value],"checked"===e[this._const.name]?r.checked=!0:"selected"===e[this._const.name]?r.selected=!0:"INPUT"===r.nodeName&&"value"===e[this._const.name]&&(r.value=e[this._const.value]);break;case this._const.modifyAttribute:r.attributes[e[this._const.name]]=e[this._const.newValue],"INPUT"===r.nodeName&&"value"===e[this._const.name]&&(r.value=e[this._const.value]);break;case this._const.removeAttribute:delete r.attributes[e[this._const.name]],0===ct(r.attributes).length&&delete r.attributes,"checked"===e[this._const.name]?r.checked=!1:"selected"===e[this._const.name]?delete r.selected:"INPUT"===r.nodeName&&"value"===e[this._const.name]&&delete r.value;break;case this._const.modifyTextElement:r.data=e[this._const.newValue],"TEXTAREA"===a.nodeName&&(a.value=e[this._const.newValue]);break;case this._const.modifyValue:r.value=e[this._const.newValue];break;case this._const.modifyComment:r.data=e[this._const.newValue];break;case this._const.modifyChecked:r.checked=e[this._const.newValue];break;case this._const.modifySelected:r.selected=e[this._const.newValue];break;case this._const.replaceElement:(n=e[this._const.newValue]).outerDone=!0,n.innerDone=!0,n.valueDone=!0,a.childNodes[u]=n;break;case this._const.relocateGroup:It(r.childNodes.splice(e[this._const.from],e.groupLength).reverse(),(function(t){r.childNodes.splice(e[c._const.to],0,t)}));break;case this._const.removeElement:a.childNodes.splice(u,1);break;case this._const.addElement:o=(i=e[this._const.route].slice()).splice(i.length-1,1)[0],r=this.getFromVirtualRoute(t,i).node,(n=e[this._const.element]).outerDone=!0,n.innerDone=!0,n.valueDone=!0,r.childNodes||(r.childNodes=[]),o>=r.childNodes.length?r.childNodes.push(n):r.childNodes.splice(o,0,n);break;case this._const.removeTextElement:a.childNodes.splice(u,1),"TEXTAREA"===a.nodeName&&delete a.value;break;case this._const.addTextElement:o=(i=e[this._const.route].slice()).splice(i.length-1,1)[0],(n={}).nodeName="#text",n.data=e[this._const.value],(r=this.getFromVirtualRoute(t,i).node).childNodes||(r.childNodes=[]),o>=r.childNodes.length?r.childNodes.push(n):r.childNodes.splice(o,0,n),"TEXTAREA"===r.nodeName&&(r.value=e[this._const.newValue]);break;default:console.log("unknown action")}l.newNode=n,this.postVirtualDiffApply(l)},apply:function(t,e){return It(e,(function(e){this.applyDiff(t,e)}),this),!0},getFromRoute:function(t,e){e=e.slice();for(var n=t;e.length>0;){if(!n.childNodes)return!1;n=n.childNodes[e.splice(0,1)[0]]}return n},applyDiff:function(t,e){var n,i,o,s,r=this.getFromRoute(t,e[this._const.route]),a=this,u={diff:e,node:r};if(this.preDiffApply(u))return!0;switch(e[this._const.action]){case this._const.addAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(e[this._const.name],e[this._const.value]);break;case this._const.modifyAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(e[this._const.name],e[this._const.newValue]);break;case this._const.removeAttribute:if(!r||!r.removeAttribute)return!1;r.removeAttribute(e[this._const.name]);break;case this._const.modifyTextElement:if(!r||3!==r.nodeType)return!1;this.textDiff(r,r.data,e[this._const.oldValue],e[this._const.newValue]);break;case this._const.modifyValue:if(!r||void 0===r.value)return!1;r.value=e[this._const.newValue];break;case this._const.modifyComment:if(!r||void 0===r.data)return!1;this.textDiff(r,r.data,e[this._const.oldValue],e[this._const.newValue]);break;case this._const.modifyChecked:if(!r||void 0===r.checked)return!1;r.checked=e[this._const.newValue];break;case this._const.modifySelected:if(!r||void 0===r.selected)return!1;r.selected=e[this._const.newValue];break;case this._const.replaceElement:r.parentNode.replaceChild(this.objToNode(e[this._const.newValue],"http://www.w3.org/2000/svg"===r.namespaceURI),r);break;case this._const.relocateGroup:It(Array.apply(null,new Array(e.groupLength)).map((function(){return r.removeChild(r.childNodes[e[a._const.from]])})),(function(t,n){0===n&&(i=r.childNodes[e[a._const.to]]),r.insertBefore(t,i)}));break;case this._const.removeElement:r.parentNode.removeChild(r);break;case this._const.addElement:s=(o=e[this._const.route].slice()).splice(o.length-1,1)[0],(r=this.getFromRoute(t,o)).insertBefore(this.objToNode(e[this._const.element],"http://www.w3.org/2000/svg"===r.namespaceURI),r.childNodes[s]);break;case this._const.removeTextElement:if(!r||3!==r.nodeType)return!1;r.parentNode.removeChild(r);break;case this._const.addTextElement:if(o=e[this._const.route].slice(),s=o.splice(o.length-1,1)[0],n=document.createTextNode(e[this._const.value]),!(r=this.getFromRoute(t,o))||!r.childNodes)return!1;r.insertBefore(n,r.childNodes[s]);break;default:console.log("unknown action")}return u.newNode=n,this.postDiffApply(u),!0}};var De=new Ee({diffcap:998}),Te="content"in document.createElement("template"),Ae={UIEvent:["focus","blur","focusin","focusout"],MouseEvent:["click","dbclick","mouseup","mousedown","mouseout","mouseover","mouseenter","mouseleave"],KeyboardEvent:["keydown","keypress","keyup"]};K.prototype={get:function(t){return 0 in arguments?this.el[+t+(t<0?this.length:0)]:this.el},each:function(t,e){return It(this.el,t,e||this),this},find:function(t){var e=[];return It(this.el,(function(n){e=dt(n.querySelectorAll(t)).concat(e)})),X(e)},closest:function(t,e){for(var n,i=this.el,o=this.get(0),s=0,r=i.length;s<r;s++,o=i[s]){for(;o&&!n&&o!==e;)X.matchz(o=o.parentNode,t)&&(n=o);if(n)break}return X(n||[])},on:function(t,e,n,i,o){var s,r,a=this;return t&&"string"!=typeof t?(Ot(t,(function(t,i){a.on(i,e,n,t,o)})),a):("string"==typeof e||_t(i)||!1===i||(i=n,n=e,e=void 0),void 0!==i&&!1!==n||(i=n,n=void 0),!1===i&&(i=m),a.each((function(a){o&&(s=function(t){return f(a,t.type,i),i.apply(this,arguments)}),e&&(r=function(t){var n,o=X.matchz(t.target,e)?t.target:X(t.target).closest(e,a).get(0);if(o&&o!==a)return n=pt(g(t),{currentTarget:o,liveFired:a}),(s||i).apply(o,[n].concat(dt(arguments,1)))}),d(a,t,i,n,e,r||s)})))},off:function(t,e,n){return t&&"string"!=typeof t?(Ot(t,(function(t,n){this.off(n,e,t)}),this),this):("string"==typeof e||_t(n)||!1===n||(n=e,e=void 0),!1===n&&(n=m),this.each((function(i){f(i,t,n,e)})))},trigger:function(t,e){return t="string"==typeof t?X.Event(t):v(t),t._args=e,this.each((function(n){t.type in oe&&_t(n[t.type])?n[t.type]():"dispatchEvent"in n?n.dispatchEvent(t):X(n).triggerHandler(t,e)}))},triggerHandler:function(t,e){var n,i;return this.each((function(o){(n=g("string"==typeof t?X.Event(t):t))._args=e,n.target=o,Ot(s(o,t.type||t),(function(t){if(i=t.proxy(n),n.isImmediatePropagationStopped())return!1}))})),i},html:function(t){return this.each((function(e){e.innerHTML=t}))},render:function(t){return this.each((function(e){this.apply(e,this.diff(e,b(e,1===t.nodeType?t.outerHTML:vt(t))))}),De)}};Yt("[ checker -> ax.va.{{#type}} ]");var Se=Yt("The value Of *( {{#value}} ) with type [ {{#type}} ] not pass validate! {{#msg}}"),Oe=[],Re=rt.localStorage,Ie=String.fromCharCode;W={t:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",kAt:function(t,e){return t.charCodeAt(~~(e%t.length))},ecd:function(t){var e,n,i,o,s,r,a=0,u="";if(!t)return t;do{e=(s=t[a++]<<16|t[a++]<<8|t[a++])>>18&63,n=s>>12&63,i=s>>6&63,o=63&s,u+=this.t.charAt(e)+this.t.charAt(n)+this.t.charAt(i)+this.t.charAt(o)}while(a<t.length);return((r=t.length%3)?u.slice(0,r-3):u)+"===".slice(r||3)},dcd:function(t){var e,n,i,o,s,r,a=0,u=[];if(!t)return t;t+="";do{e=(r=this.t.indexOf(t.charAt(a++))<<18|this.t.indexOf(t.charAt(a++))<<12|(o=this.t.indexOf(t.charAt(a++)))<<6|(s=this.t.indexOf(t.charAt(a++))))>>16&255,n=r>>8&255,i=255&r,u.push(e),64!==o&&(u.push(n),64!==s&&u.push(i))}while(a<t.length);return u},incry:function(t,e){for(var n=[],i=0,o=t.length;i<o;i++)n[i]=t[i].charCodeAt(0)^this.kAt(e,i);return this.ecd(n)},decyt:function(t,e){for(var n=0,i=(t=this.dcd(t)).length;n<i;n++)t[n]=Ie(t[n]^this.kAt(e,n));return t.join("")},set:function(t,e){Re.setItem("Ax@"+this.incry(t,O(t)),this.incry(JSON.stringify(e),t))},get:function(t){var e=Re.getItem("Ax@"+this.incry(t,O(t)));return e?JSON.parse(this.decyt(e,t)):0},rm:function(t){Re.removeItem("Ax@"+this.incry(t,O(t)))}},($=function(t){var e=pt(ft(it),t||{}),n=e.events,i=e.validate,o=Vt(e.name||0),s=e.store&&o,r=e.data||{},a=s?W.get(e.name)||r:r;delete e.data,delete e.store,delete e.change,delete e.events,delete e.validate,ht(this,"data",{get:function(){return ft(a)},set:function(t){if(mt(a,t))return a;var e,n=[ft(t)];return this.emit("validate",n),(Et(t)?_t(i)&&!i(t):(e=N(a,t,i),Ut(e)))?(this.emit("validate:fail",n.concat(e)),kt(e)&&2===Ut(e)&&this.emit("validate:fail:"+Xt(e),[Kt(e)]),a):(a=t,this.change=!0,s&&W.set(this.name,t),this.emit("validate:success,change",n),t)},enumerable:!0,configurable:!1}),Rt(n,w,this),pt(this,e).emit("init",[this.data]).unbind("init"),Oe[o?this.name:"_"]=this}).prototype={constructor:$,get:function(t){return Nt(t)||!t&&0!==t?this.data:Lt.apply(this,[this.data].concat(dt(arguments)))},set:function(t,e){return this.data=1 in arguments?zt(this.data,t,e):void 0===t?this.data:t,Vt(t)?this.emit("change:"+t,[e]):this},rm:function(t){var e=this.data;return null!==(this.data=t?kt(e)?(e.splice(+t,1),e):Ft(e,t):null)&&this.emit("remove:"+t)},moc:function(t,e){return this.set(t,E(Lt(this.data,t),e))},on:V,emit:x,unbind:k,toJSON:function(){return Et(this.data)?this.data:JSON.stringify(this.data)},send:function(t,e){return yt(t)&&(e=t,t=null),S.apply(this,["send",t||this.url,this.data,lt,lt,e])},fetch:function(t,e,n){return _t(t)&&(n=e,e=t,t={}),S.apply(this,["fetch",this.url,t,$t(_t(e)?e:JSON.parse,this.set.bind(this)),lt,n])},sync:function(t,e){return yt(t)&&(e=t,t=null),S.apply(this,["sync",t||this.url,this.data,lt,lt,e])},toString:function(){return vt(this.toJSON())}},(Y=function(t){var e=pt(ft(et),t||{}),n=e.root,i=e.render,o=e.events,s=e.template,r=e.props;delete e.root,delete e.mount,delete e.props,delete e.events,delete e.render,delete e.template,_t(i)||(s=Vt(s)?Yt(s,yt(r)?r:{}):_t(s)?s:lt,i=function(){var t=X(n),e=dt(arguments);return s!==lt&&(""===Jt(t.get(0).innerHTML)?t.html(s.apply(this,e)):t.render(s.apply(this,e)))}),n&&C(n)?(this.root=n,Rt(o,w,M(this,i)),e.model&&tt.model(e.model)&&e.model.on("change",this.render.bind(this))):this.mount=function(t){if(C(t))return this.root=n=t,Rt(o,w,M(this,i)),e.model&&tt.model(e.model)&&e.model.on("change",this.render.bind(this)),1 in arguments&&this.render.apply(this,dt(arguments,1)),delete this.mount,this},pt(this,e).emit("init").unbind("init")}).prototype={constructor:Y,on:function(t,e){return It((t||"").split(","),(function(t){var n=t.split(":");n.length>1?X(this.root).on(n[0],n[1],{self:this},e):jt(this,t,e)}),this),this},unbind:function(t,e){return It((t||"").split(","),(function(t){var n=t.split(":");n.length>1?X(this.root).off(n[0],n[1],e):Mt(this,t,e)}),this),this},emit:function(t,e){var n=(t||"").split(":");return n.length>2?(It((t||"").split(","),(function(t){var n=t.split(":");X(this.root).find(n[1]).trigger(n[0],e)}),this),this):n.length>1?(X(this.root).find(n[1]).trigger(n[0],e),this):Ct(this,t,e)},toString:function(){return this.root}},(Z=function(t){var e=this,n={old:"",now:rt.location.href},i=pt(ft(ot),t||{}),o=i.events;delete i.history,delete i.events,ht(this,"event",{value:function(t){return rt.location.href===n.now?t.preventDefault():(n.old=n.now,e.emit("hashchange",[n.now=rt.location.href,i.char,t]))},writable:!1,enumerable:!1,configurable:!1}),Rt(o,w,this),pt(this,i).on("hashchange",F).emit("init").unbind("init")}).prototype={constructor:Z,on:V,emit:x,unbind:k,listen:function(t,e){return this._listen?this:(ht(this,"_listen",{value:!rt.addEventListener("hashchange",this.event),writable:!1,enumerable:!1,configurable:!0}),t?this.assign(t,e):this.emit("hashchange",[rt.location.href,this.char]))},stop:function(){return delete this._listen&&rt.removeEventListener("hashchange",this.event),this},assign:function(t,e){if(this._listen){var n=rt.location.href,i=n.search("#");i>0&&(n=n.slice(0,i)),rt.location.href=n+("#"===t.toString().slice(0,1)?"":"#")+t+(yt(e)?(this.char||"@")+Gt(e):"")}return this},toString:function(){return this}};var Pe=[],je=function(e,n){var i=t.atom({use:n},!0);return i.back=function(){return e},i};return(Q=function(t,e){var n=pt(ft(nt),t||{}),i=n.use,o=n.events,s=[];delete n.use,delete n.events,this._assert=J(s),pt(this.use(i),n),e||(Rt(o,w,this),this.emit("init").unbind("init"))}).prototype={constructor:Q,all:function(){return this._assert(dt,Pe)},on:V,emit:x,unbind:k,use:function(t){return H.call(this,t,(function(t,e,n){n=Oe[e],e&&n&&tt.model(n)&&!qt(t,n)&&t.push(n)}))},out:function(t){return H.call(this,t,(function(t,e){t.splice(Qt(t,q.bind(e)),1)}))},p:function(t){return Wt(this.all(),q.bind(t))},of:function(t,e){return It(this.all(),_t(t)?t:G(t,e)),this},select:function(t){return je(this,U(this.all(),t))},toData:function(){return this.all().map((function(t){return t.get()}))},toJSON:function(){return JSON.stringify(this.toData())}},It(["extend","not","cat","find","filter","reject","chunk","compact","pluck","groupBy","countBy","pairs","shuffle","flat","merge","map","sort","unique","concat","pull","drop","pairs",["hook","map","hook"],["mapKey","map","key"],["uniqueFast","unique","fast"],["pullAt","pull","at"],["dropLeft","drop","left"],["dropRight","drop","right"],["dropLeftTo","drop","leftto"],["dropRightTo","drop","rightto"],["unpairs","pairs","un"]],(function(t){var n,i,o;kt(t)?(i=t[1],n=t[0],o=t[2]):(i=t,n=t,o=void 0),$.prototype[n]=function(){var n=this.data,s=[n].concat(dt(arguments));return mt(n=e[i](o).apply(n,s),this.data)||this.emit((this.data=n,t),s),this},Q.prototype[n]=function(){return e[i](o).apply(this,[this.toData()].concat(dt(arguments)))}})),It(["keys","every","some","diff","intsec","first","last","auto","eq","values","size","each","has","type","index",["hasKey","has","key"],["findex","index","first"],["lindex","index","last"],["single","index","one"],["one","index","one"]],(function(t){var n,i,o;kt(t)?(i=t[1],n=t[0],o=t[2]):(i=t,n=t,o=void 0),$.prototype[n]=function(){var t=[this.data].concat(dt(arguments));return e[i](o).apply(this,t)},Q.prototype[n]=function(){return e[i](o).apply(this,[this.toData()].concat(dt(arguments)))}})),t.route=n(Z),t.model=n($),t.view=n(Y),t.atom=n(Q),t.route.extend=i(Z),t.model.extend=i($),t.view.extend=i(Y),t.atom.extend=i(Q),t.va=tt={fn:T(_t,"function"),int:T(wt,"int"),array:T(kt,"array"),float:T(Dt,"float"),string:T(Vt,"string"),object:T(yt,"object"),number:T(bt,"number"),arrayLike:T(xt,"arrayLike"),primitive:T(Et,"primitive"),bool:T(Nt,"boolean"),dom:T(Tt,"dom"),element:T(At,"element"),node:T(St,"node"),model:T(A($),"model"),view:T(A(Y),"view"),atom:T(A(Q),"atom"),route:T(A(Z),"route")},ut($,Y,Z,Q,W,tt,at(t))}));